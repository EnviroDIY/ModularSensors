{
  "version": "1.12.0",
  "compound": {
    "kind": "page",
    "id": "example_data_saving",
    "name": "Minimizing Cellular Data Use",
    "url_base": "example_data_saving",
    "url": "example_data_saving.html",
    "include": null,
    "has_template_details": false,
    "templates": null,
    "brief": "",
    "description": "<p><a name=\"md_examples_2data__saving_2_read_me\"></a></p><p>This is another double logger example, but in this case, both loggers are going at the same interval and the only difference between the loggers is the list of variables. There are two sets of variables, all coming from Yosemitech sensors. Because each sensor outputs temperature and we don&#x27;t want to waste cellular data sending out multiple nearly identical temperature values, we have one logger that logs every possible variable result to the SD card and another logger that sends only unique results to the EnviroDIY data portal.</p><p>The modem used in this example is a SIM800 based Sodaq GPRSBee r6.</p><p>The sensors used in this example are Yosemitech Y504 Dissolved Oxygen <a href=\"class_sensor.html\" class=\"m-doc\">Sensor</a>, Yosemitech Y511 Turbidity <a href=\"class_sensor.html\" class=\"m-doc\">Sensor</a> with Wiper, Yosemitech Y514 Chlorophyll <a href=\"class_sensor.html\" class=\"m-doc\">Sensor</a>, and Yosemitech Y520 Conductivity <a href=\"class_sensor.html\" class=\"m-doc\">Sensor</a>.</p><hr/><hr/><section id=\"example_data_saving_unique\"><h2>Unique Features of the Data Saving Example</h2><ul><li>Uses AltSoftSerial to create an additional serial port for RS485 communication.</li><li>All variables are created and named with their parent sensor (as opposed to being created within the variable array).</li><li>Two different variable arrays and loggers are created and used.<ul><li>Many of the same variables are used in both arrays.</li><li>Only one of the loggers publishes data.</li></ul></li><li>The <code>loop</code> function is expanded into its components rather than using the <code>logData</code> functions.<ul><li>This demonstrates <em>how</em> to write the loop out, without using the <code>logData</code> functions.</li><li>It also shows how to forcibly set serial pins <code>LOW</code> at the start and end of the loop in order to prevent power loss through an RS485 adapter.</li></ul></li></ul></section><section id=\"example_data_saving_using\"><h2>To Use this Example</h2><section id=\"example_data_saving_pio\"><h3>Prepare and set up PlatformIO</h3><ul><li>Register a site and sensors at the Monitor My Watershed/EnviroDIY data portal (<a href=\"http://monitormywatershed.org/\">http:/<wbr />/<wbr />monitormywatershed.org/<wbr /></a>)</li><li>Create a new PlatformIO project</li><li>Replace the contents of the platformio.ini for your new project with the <a href=\"https://raw.githubusercontent.com/EnviroDIY/ModularSensors/master/examples/data_saving/platformio.ini\">platformio.ini</a> file in the examples/data_saving folder on GitHub.<ul><li>It is important that your PlatformIO configuration has the lib_ldf_mode and build flags set as they are in the example.</li><li>Without this, the program won&#x27;t compile.</li></ul></li><li>Open <a href=\"https://raw.githubusercontent.com/EnviroDIY/ModularSensors/master/examples/data_saving/data_saving.ino\">data_<wbr />saving.ino</a> and save it to your computer.<ul><li>After opening the link, you should be able to right click anywhere on the page and select &quot;Save Page As&quot;.</li><li>Move it into the src directory of your project.</li><li>Delete main.cpp in that folder.</li></ul></li></ul></section><section id=\"example_data_saving_logger_id\"><h3>Set the logger ID</h3><ul><li>Change the &quot;XXXX&quot; in this section of code to the loggerID assigned by Stroud:</li></ul><div class=\"m-code-arduino\"><div class=\"highlight\"><div class=\"line\"><a id=\"l-1\" name=\"l-1\"></a><span class=\"linenos\">1</span><span class=\"c1\">// Logger ID, also becomes the prefix for the name of the data file on SD card</span>\n</div><div class=\"line\"><a id=\"l-2\" name=\"l-2\"></a><span class=\"linenos\">2</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kt\">char</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">LoggerID</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">&quot;XXXX&quot;</span><span class=\"p\">;</span>\n</div></div></div></section><section id=\"example_data_saving_uuids\"><h3>Set the universally universal identifiers (UUID) for each variable</h3><ul><li>Go back to the web page for your site at the Monitor My Watershed/EnviroDIY data portal (<a href=\"http://monitormywatershed.org/\">http:/<wbr />/<wbr />monitormywatershed.org/<wbr /></a>)</li><li>For each variable, find the dummy UUID (<code>&quot;12345678-abcd-1234-ef00-1234567890ab&quot;</code>) and replace it with the real UUID for the variable.</li></ul></section><section id=\"example_data_saving_upload\"><h3>Upload!</h3><ul><li>Test everything at home <strong>before</strong> deploying out in the wild!</li></ul><hr/></section></section><section id=\"example_data_saving_pio_config\"><h2>PlatformIO Configuration</h2><div class=\"m-code-pygments-default\"><div class=\"highlight\"><div class=\"line\"><a id=\"l-1\" name=\"l-1\"></a><span class=\"linenos\"> 1</span><span class=\"c1\">; PlatformIO Project Configuration File</span>\n</div><div class=\"line\"><a id=\"l-2\" name=\"l-2\"></a><span class=\"linenos\"> 2</span><span class=\"c1\">;</span>\n</div><div class=\"line\"><a id=\"l-3\" name=\"l-3\"></a><span class=\"linenos\"> 3</span><span class=\"c1\">;   Build options: build flags, source filter</span>\n</div><div class=\"line\"><a id=\"l-4\" name=\"l-4\"></a><span class=\"linenos\"> 4</span><span class=\"c1\">;   Upload options: custom upload port, speed and extra flags</span>\n</div><div class=\"line\"><a id=\"l-5\" name=\"l-5\"></a><span class=\"linenos\"> 5</span><span class=\"c1\">;   Library options: dependencies, extra library storages</span>\n</div><div class=\"line\"><a id=\"l-6\" name=\"l-6\"></a><span class=\"linenos\"> 6</span><span class=\"c1\">;   Advanced options: extra scripting</span>\n</div><div class=\"line\"><a id=\"l-7\" name=\"l-7\"></a><span class=\"linenos\"> 7</span><span class=\"c1\">;</span>\n</div><div class=\"line\"><a id=\"l-8\" name=\"l-8\"></a><span class=\"linenos\"> 8</span><span class=\"c1\">; Please visit documentation for the other options and examples</span>\n</div><div class=\"line\"><a id=\"l-9\" name=\"l-9\"></a><span class=\"linenos\"> 9</span><span class=\"c1\">; http://docs.platformio.org/page/projectconf.html</span>\n</div><div class=\"line\"><a id=\"l-10\" name=\"l-10\"></a><span class=\"linenos\">10</span>\n</div><div class=\"line\"><a id=\"l-11\" name=\"l-11\"></a><span class=\"linenos\">11</span><span class=\"k\">[platformio]</span>\n</div><div class=\"line\"><a id=\"l-12\" name=\"l-12\"></a><span class=\"linenos\">12</span><span class=\"na\">description</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">ModularSensors example using two &quot;loggers&quot; to save cellular data</span>\n</div><div class=\"line\"><a id=\"l-13\" name=\"l-13\"></a><span class=\"linenos\">13</span>\n</div><div class=\"line\"><a id=\"l-14\" name=\"l-14\"></a><span class=\"linenos\">14</span><span class=\"k\">[env:mayfly]</span>\n</div><div class=\"line\"><a id=\"l-15\" name=\"l-15\"></a><span class=\"linenos\">15</span><span class=\"na\">monitor_speed</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">115200</span>\n</div><div class=\"line\"><a id=\"l-16\" name=\"l-16\"></a><span class=\"linenos\">16</span><span class=\"na\">board</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">mayfly</span>\n</div><div class=\"line\"><a id=\"l-17\" name=\"l-17\"></a><span class=\"linenos\">17</span><span class=\"na\">platform</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">atmelavr</span>\n</div><div class=\"line\"><a id=\"l-18\" name=\"l-18\"></a><span class=\"linenos\">18</span><span class=\"na\">framework</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">arduino</span>\n</div><div class=\"line\"><a id=\"l-19\" name=\"l-19\"></a><span class=\"linenos\">19</span><span class=\"na\">lib_ldf_mode</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">deep+</span>\n</div><div class=\"line\"><a id=\"l-20\" name=\"l-20\"></a><span class=\"linenos\">20</span><span class=\"na\">lib_ignore</span><span class=\"w\"> </span><span class=\"o\">=</span>\n</div><div class=\"line\"><a id=\"l-21\" name=\"l-21\"></a><span class=\"linenos\">21</span><span class=\"w\">    </span><span class=\"na\">RTCZero</span>\n</div><div class=\"line\"><a id=\"l-22\" name=\"l-22\"></a><span class=\"linenos\">22</span><span class=\"w\">    </span><span class=\"na\">Adafruit NeoPixel</span>\n</div><div class=\"line\"><a id=\"l-23\" name=\"l-23\"></a><span class=\"linenos\">23</span><span class=\"w\">    </span><span class=\"na\">Adafruit GFX Library</span>\n</div><div class=\"line\"><a id=\"l-24\" name=\"l-24\"></a><span class=\"linenos\">24</span><span class=\"w\">    </span><span class=\"na\">Adafruit SSD1306</span>\n</div><div class=\"line\"><a id=\"l-25\" name=\"l-25\"></a><span class=\"linenos\">25</span><span class=\"w\">    </span><span class=\"na\">Adafruit ADXL343</span>\n</div><div class=\"line\"><a id=\"l-26\" name=\"l-26\"></a><span class=\"linenos\">26</span><span class=\"w\">    </span><span class=\"na\">Adafruit STMPE610</span>\n</div><div class=\"line\"><a id=\"l-27\" name=\"l-27\"></a><span class=\"linenos\">27</span><span class=\"w\">    </span><span class=\"na\">Adafruit TouchScreen</span>\n</div><div class=\"line\"><a id=\"l-28\" name=\"l-28\"></a><span class=\"linenos\">28</span><span class=\"w\">    </span><span class=\"na\">Adafruit ILI9341</span>\n</div><div class=\"line\"><a id=\"l-29\" name=\"l-29\"></a><span class=\"linenos\">29</span><span class=\"na\">build_flags</span><span class=\"w\"> </span><span class=\"o\">=</span>\n</div><div class=\"line\"><a id=\"l-30\" name=\"l-30\"></a><span class=\"linenos\">30</span><span class=\"w\">    </span><span class=\"na\">-DSDI12_EXTERNAL_PCINT</span>\n</div><div class=\"line\"><a id=\"l-31\" name=\"l-31\"></a><span class=\"linenos\">31</span><span class=\"w\">    </span><span class=\"na\">-DNEOSWSERIAL_EXTERNAL_PCINT</span>\n</div><div class=\"line\"><a id=\"l-32\" name=\"l-32\"></a><span class=\"linenos\">32</span><span class=\"w\">    </span><span class=\"na\">-DMQTT_MAX_PACKET_SIZE</span><span class=\"o\">=</span><span class=\"s\">240</span>\n</div><div class=\"line\"><a id=\"l-33\" name=\"l-33\"></a><span class=\"linenos\">33</span><span class=\"w\">    </span><span class=\"na\">-DTINY_GSM_RX_BUFFER</span><span class=\"o\">=</span><span class=\"s\">64</span>\n</div><div class=\"line\"><a id=\"l-34\" name=\"l-34\"></a><span class=\"linenos\">34</span><span class=\"w\">    </span><span class=\"na\">-DTINY_GSM_YIELD_MS</span><span class=\"o\">=</span><span class=\"s\">2</span>\n</div><div class=\"line\"><a id=\"l-35\" name=\"l-35\"></a><span class=\"linenos\">35</span><span class=\"na\">lib_deps</span><span class=\"w\"> </span><span class=\"o\">=</span>\n</div><div class=\"line\"><a id=\"l-36\" name=\"l-36\"></a><span class=\"linenos\">36</span><span class=\"w\">    </span><span class=\"na\">envirodiy/EnviroDIY_ModularSensors</span>\n</div><div class=\"line\"><a id=\"l-37\" name=\"l-37\"></a><span class=\"linenos\">37</span><span class=\"c1\">;  ^^ Use this when working from an official release of the library</span>\n</div><div class=\"line\"><a id=\"l-38\" name=\"l-38\"></a><span class=\"linenos\">38</span><span class=\"c1\">;    https://github.com/EnviroDIY/ModularSensors.git#develop</span>\n</div><div class=\"line\"><a id=\"l-39\" name=\"l-39\"></a><span class=\"linenos\">39</span><span class=\"c1\">;  ^^ Use this when if you want to pull from the develop branch</span>\n</div><div class=\"line\"><a id=\"l-40\" name=\"l-40\"></a><span class=\"linenos\">40</span><span class=\"w\">    </span><span class=\"na\">https</span><span class=\"o\">:</span><span class=\"s\">//github.com/PaulStoffregen/AltSoftSerial.git</span>\n</div></div></div></section><section id=\"example_data_saving_code\"><h2>The Complete Code</h2><div class=\"m-code-arduino\"><div class=\"highlight\"><div class=\"line\"><a id=\"l-1\" name=\"l-1\"></a><span class=\"linenos\">  1</span><span class=\"cm\">/** =========================================================================</span>\n</div><div class=\"line\"><a id=\"l-2\" name=\"l-2\"></a><span class=\"linenos\">  2</span><span class=\"cm\"> * @example{lineno} data_saving.ino</span>\n</div><div class=\"line\"><a id=\"l-3\" name=\"l-3\"></a><span class=\"linenos\">  3</span><span class=\"cm\"> * @copyright Stroud Water Research Center</span>\n</div><div class=\"line\"><a id=\"l-4\" name=\"l-4\"></a><span class=\"linenos\">  4</span><span class=\"cm\"> * @license This example is published under the BSD-3 license.</span>\n</div><div class=\"line\"><a id=\"l-5\" name=\"l-5\"></a><span class=\"linenos\">  5</span><span class=\"cm\"> * @author Sara Geleskie Damiano &lt;sdamiano@stroudcenter.org&gt;</span>\n</div><div class=\"line\"><a id=\"l-6\" name=\"l-6\"></a><span class=\"linenos\">  6</span><span class=\"cm\"> *</span>\n</div><div class=\"line\"><a id=\"l-7\" name=\"l-7\"></a><span class=\"linenos\">  7</span><span class=\"cm\"> * @brief Example publishing only a portion of the logged variables.</span>\n</div><div class=\"line\"><a id=\"l-8\" name=\"l-8\"></a><span class=\"linenos\">  8</span><span class=\"cm\"> *</span>\n</div><div class=\"line\"><a id=\"l-9\" name=\"l-9\"></a><span class=\"linenos\">  9</span><span class=\"cm\"> * See [the walkthrough page](@ref example_data_saving) for detailed</span>\n</div><div class=\"line\"><a id=\"l-10\" name=\"l-10\"></a><span class=\"linenos\"> 10</span><span class=\"cm\"> * instructions.</span>\n</div><div class=\"line\"><a id=\"l-11\" name=\"l-11\"></a><span class=\"linenos\"> 11</span><span class=\"cm\"> *</span>\n</div><div class=\"line\"><a id=\"l-12\" name=\"l-12\"></a><span class=\"linenos\"> 12</span><span class=\"cm\"> * @m_examplenavigation{example_data_saving,}</span>\n</div><div class=\"line\"><a id=\"l-13\" name=\"l-13\"></a><span class=\"linenos\"> 13</span><span class=\"cm\"> * ======================================================================= */</span>\n</div><div class=\"line\"><a id=\"l-14\" name=\"l-14\"></a><span class=\"linenos\"> 14</span>\n</div><div class=\"line\"><a id=\"l-15\" name=\"l-15\"></a><span class=\"linenos\"> 15</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-16\" name=\"l-16\"></a><span class=\"linenos\"> 16</span><span class=\"c1\">//  Defines for TinyGSM</span>\n</div><div class=\"line\"><a id=\"l-17\" name=\"l-17\"></a><span class=\"linenos\"> 17</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-18\" name=\"l-18\"></a><span class=\"linenos\"> 18</span><span class=\"cm\">/** Start [defines] */</span>\n</div><div class=\"line\"><a id=\"l-19\" name=\"l-19\"></a><span class=\"linenos\"> 19</span><span class=\"cp\">#ifndef TINY_GSM_RX_BUFFER</span>\n</div><div class=\"line\"><a id=\"l-20\" name=\"l-20\"></a><span class=\"linenos\"> 20</span><span class=\"cp\">#define TINY_GSM_RX_BUFFER 64</span>\n</div><div class=\"line\"><a id=\"l-21\" name=\"l-21\"></a><span class=\"linenos\"> 21</span><span class=\"cp\">#endif</span>\n</div><div class=\"line\"><a id=\"l-22\" name=\"l-22\"></a><span class=\"linenos\"> 22</span><span class=\"cp\">#ifndef TINY_GSM_YIELD_MS</span>\n</div><div class=\"line\"><a id=\"l-23\" name=\"l-23\"></a><span class=\"linenos\"> 23</span><span class=\"cp\">#define TINY_GSM_YIELD_MS 2</span>\n</div><div class=\"line\"><a id=\"l-24\" name=\"l-24\"></a><span class=\"linenos\"> 24</span><span class=\"cp\">#endif</span>\n</div><div class=\"line\"><a id=\"l-25\" name=\"l-25\"></a><span class=\"linenos\"> 25</span><span class=\"cm\">/** End [defines] */</span>\n</div><div class=\"line\"><a id=\"l-26\" name=\"l-26\"></a><span class=\"linenos\"> 26</span>\n</div><div class=\"line\"><a id=\"l-27\" name=\"l-27\"></a><span class=\"linenos\"> 27</span>\n</div><div class=\"line\"><a id=\"l-28\" name=\"l-28\"></a><span class=\"linenos\"> 28</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-29\" name=\"l-29\"></a><span class=\"linenos\"> 29</span><span class=\"c1\">//  Include the libraries required for any data logger</span>\n</div><div class=\"line\"><a id=\"l-30\" name=\"l-30\"></a><span class=\"linenos\"> 30</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-31\" name=\"l-31\"></a><span class=\"linenos\"> 31</span><span class=\"cm\">/** Start [includes] */</span>\n</div><div class=\"line\"><a id=\"l-32\" name=\"l-32\"></a><span class=\"linenos\"> 32</span><span class=\"c1\">// The Arduino library is needed for every Arduino program.</span>\n</div><div class=\"line\"><a id=\"l-33\" name=\"l-33\"></a><span class=\"linenos\"> 33</span><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;Arduino.h&gt;</span>\n</div><div class=\"line\"><a id=\"l-34\" name=\"l-34\"></a><span class=\"linenos\"> 34</span>\n</div><div class=\"line\"><a id=\"l-35\" name=\"l-35\"></a><span class=\"linenos\"> 35</span><span class=\"c1\">// Include the main header for ModularSensors</span>\n</div><div class=\"line\"><a id=\"l-36\" name=\"l-36\"></a><span class=\"linenos\"> 36</span><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;ModularSensors.h&gt;</span>\n</div><div class=\"line\"><a id=\"l-37\" name=\"l-37\"></a><span class=\"linenos\"> 37</span><span class=\"cm\">/** End [includes] */</span>\n</div><div class=\"line\"><a id=\"l-38\" name=\"l-38\"></a><span class=\"linenos\"> 38</span>\n</div><div class=\"line\"><a id=\"l-39\" name=\"l-39\"></a><span class=\"linenos\"> 39</span>\n</div><div class=\"line\"><a id=\"l-40\" name=\"l-40\"></a><span class=\"linenos\"> 40</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-41\" name=\"l-41\"></a><span class=\"linenos\"> 41</span><span class=\"c1\">//  Settings for Additional Serial Ports</span>\n</div><div class=\"line\"><a id=\"l-42\" name=\"l-42\"></a><span class=\"linenos\"> 42</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-43\" name=\"l-43\"></a><span class=\"linenos\"> 43</span><span class=\"cm\">/** Start [serial_ports] */</span>\n</div><div class=\"line\"><a id=\"l-44\" name=\"l-44\"></a><span class=\"linenos\"> 44</span><span class=\"c1\">// The modem and a number of sensors communicate over UART/TTL - often called</span>\n</div><div class=\"line\"><a id=\"l-45\" name=\"l-45\"></a><span class=\"linenos\"> 45</span><span class=\"c1\">// &quot;serial&quot;. &quot;Hardware&quot; serial ports (automatically controlled by the MCU) are</span>\n</div><div class=\"line\"><a id=\"l-46\" name=\"l-46\"></a><span class=\"linenos\"> 46</span><span class=\"c1\">// generally the most accurate and should be configured and used for as many</span>\n</div><div class=\"line\"><a id=\"l-47\" name=\"l-47\"></a><span class=\"linenos\"> 47</span><span class=\"c1\">// peripherals as possible.  In some cases (ie, modbus communication) many</span>\n</div><div class=\"line\"><a id=\"l-48\" name=\"l-48\"></a><span class=\"linenos\"> 48</span><span class=\"c1\">// sensors can share the same serial port.</span>\n</div><div class=\"line\"><a id=\"l-49\" name=\"l-49\"></a><span class=\"linenos\"> 49</span>\n</div><div class=\"line\"><a id=\"l-50\" name=\"l-50\"></a><span class=\"linenos\"> 50</span><span class=\"cp\">#if !defined(ARDUINO_ARCH_SAMD) &amp;&amp; !defined(ATMEGA2560)  </span><span class=\"c1\">// For AVR boards</span>\n</div><div class=\"line\"><a id=\"l-51\" name=\"l-51\"></a><span class=\"linenos\"> 51</span><span class=\"c1\">// Unfortunately, most AVR boards have only one or two hardware serial ports,</span>\n</div><div class=\"line\"><a id=\"l-52\" name=\"l-52\"></a><span class=\"linenos\"> 52</span><span class=\"c1\">// so we&#39;ll set up three types of extra software serial ports to use</span>\n</div><div class=\"line\"><a id=\"l-53\" name=\"l-53\"></a><span class=\"linenos\"> 53</span>\n</div><div class=\"line\"><a id=\"l-54\" name=\"l-54\"></a><span class=\"linenos\"> 54</span><span class=\"c1\">// AltSoftSerial by Paul Stoffregen</span>\n</div><div class=\"line\"><a id=\"l-55\" name=\"l-55\"></a><span class=\"linenos\"> 55</span><span class=\"c1\">// (https://github.com/PaulStoffregen/AltSoftSerial) is the most accurate</span>\n</div><div class=\"line\"><a id=\"l-56\" name=\"l-56\"></a><span class=\"linenos\"> 56</span><span class=\"c1\">// software serial port for AVR boards. AltSoftSerial can only be used on one</span>\n</div><div class=\"line\"><a id=\"l-57\" name=\"l-57\"></a><span class=\"linenos\"> 57</span><span class=\"c1\">// set of pins on each board so only one AltSoftSerial port can be used. Not all</span>\n</div><div class=\"line\"><a id=\"l-58\" name=\"l-58\"></a><span class=\"linenos\"> 58</span><span class=\"c1\">// AVR boards are supported by AltSoftSerial.</span>\n</div><div class=\"line\"><a id=\"l-59\" name=\"l-59\"></a><span class=\"linenos\"> 59</span><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;AltSoftSerial.h&gt;</span>\n</div><div class=\"line\"><a id=\"l-60\" name=\"l-60\"></a><span class=\"linenos\"> 60</span><span class=\"n\">AltSoftSerial</span><span class=\"w\"> </span><span class=\"n\">altSoftSerial</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-61\" name=\"l-61\"></a><span class=\"linenos\"> 61</span><span class=\"cp\">#endif  </span><span class=\"c1\">// End software serial for avr boards</span>\n</div><div class=\"line\"><a id=\"l-62\" name=\"l-62\"></a><span class=\"linenos\"> 62</span>\n</div><div class=\"line\"><a id=\"l-63\" name=\"l-63\"></a><span class=\"linenos\"> 63</span>\n</div><div class=\"line\"><a id=\"l-64\" name=\"l-64\"></a><span class=\"linenos\"> 64</span><span class=\"cp\">#if defined(ARDUINO_ARCH_SAMD)</span>\n</div><div class=\"line\"><a id=\"l-65\" name=\"l-65\"></a><span class=\"linenos\"> 65</span><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;wiring_private.h&gt;</span><span class=\"c1\">  // Needed for SAMD pinPeripheral() function</span>\n</div><div class=\"line\"><a id=\"l-66\" name=\"l-66\"></a><span class=\"linenos\"> 66</span>\n</div><div class=\"line\"><a id=\"l-67\" name=\"l-67\"></a><span class=\"linenos\"> 67</span><span class=\"cp\">#ifndef ENABLE_SERIAL2</span>\n</div><div class=\"line\"><a id=\"l-68\" name=\"l-68\"></a><span class=\"linenos\"> 68</span><span class=\"c1\">// Set up a &#39;new&#39; UART using SERCOM1</span>\n</div><div class=\"line\"><a id=\"l-69\" name=\"l-69\"></a><span class=\"linenos\"> 69</span><span class=\"c1\">// The Rx will be on digital pin 11, which is SERCOM1&#39;s Pad #0</span>\n</div><div class=\"line\"><a id=\"l-70\" name=\"l-70\"></a><span class=\"linenos\"> 70</span><span class=\"c1\">// The Tx will be on digital pin 10, which is SERCOM1&#39;s Pad #2</span>\n</div><div class=\"line\"><a id=\"l-71\" name=\"l-71\"></a><span class=\"linenos\"> 71</span><span class=\"c1\">// NOTE:  SERCOM1 is undefinied on a &quot;standard&quot; Arduino Zero and many clones,</span>\n</div><div class=\"line\"><a id=\"l-72\" name=\"l-72\"></a><span class=\"linenos\"> 72</span><span class=\"c1\">//        but not all!  Please check the variant.cpp file for you individual</span>\n</div><div class=\"line\"><a id=\"l-73\" name=\"l-73\"></a><span class=\"linenos\"> 73</span><span class=\"c1\">//        board! Sodaq Autonomo&#39;s and Sodaq One&#39;s do NOT follow the &#39;standard&#39;</span>\n</div><div class=\"line\"><a id=\"l-74\" name=\"l-74\"></a><span class=\"linenos\"> 74</span><span class=\"c1\">//        SERCOM definitions!</span>\n</div><div class=\"line\"><a id=\"l-75\" name=\"l-75\"></a><span class=\"linenos\"> 75</span><span class=\"n\">Uart</span><span class=\"w\"> </span><span class=\"nf\">Serial2</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">sercom1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">SERCOM_RX_PAD_0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">UART_TX_PAD_2</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-76\" name=\"l-76\"></a><span class=\"linenos\"> 76</span><span class=\"c1\">// Hand over the interrupts to the sercom port</span>\n</div><div class=\"line\"><a id=\"l-77\" name=\"l-77\"></a><span class=\"linenos\"> 77</span><span class=\"kr\">void</span><span class=\"w\"> </span><span class=\"nf\">SERCOM1_Handler</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-78\" name=\"l-78\"></a><span class=\"linenos\"> 78</span><span class=\"w\">    </span><span class=\"n\">Serial2</span><span class=\"p\">.</span><span class=\"n\">IrqHandler</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-79\" name=\"l-79\"></a><span class=\"linenos\"> 79</span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-80\" name=\"l-80\"></a><span class=\"linenos\"> 80</span><span class=\"cp\">#endif</span>\n</div><div class=\"line\"><a id=\"l-81\" name=\"l-81\"></a><span class=\"linenos\"> 81</span>\n</div><div class=\"line\"><a id=\"l-82\" name=\"l-82\"></a><span class=\"linenos\"> 82</span><span class=\"cp\">#endif  </span><span class=\"c1\">// End hardware serial on SAMD21 boards</span>\n</div><div class=\"line\"><a id=\"l-83\" name=\"l-83\"></a><span class=\"linenos\"> 83</span><span class=\"cm\">/** End [serial_ports] */</span>\n</div><div class=\"line\"><a id=\"l-84\" name=\"l-84\"></a><span class=\"linenos\"> 84</span>\n</div><div class=\"line\"><a id=\"l-85\" name=\"l-85\"></a><span class=\"linenos\"> 85</span>\n</div><div class=\"line\"><a id=\"l-86\" name=\"l-86\"></a><span class=\"linenos\"> 86</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-87\" name=\"l-87\"></a><span class=\"linenos\"> 87</span><span class=\"c1\">//  Data Logging Options</span>\n</div><div class=\"line\"><a id=\"l-88\" name=\"l-88\"></a><span class=\"linenos\"> 88</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-89\" name=\"l-89\"></a><span class=\"linenos\"> 89</span><span class=\"cm\">/** Start [logging_options] */</span>\n</div><div class=\"line\"><a id=\"l-90\" name=\"l-90\"></a><span class=\"linenos\"> 90</span><span class=\"c1\">// The name of this program file</span>\n</div><div class=\"line\"><a id=\"l-91\" name=\"l-91\"></a><span class=\"linenos\"> 91</span><span class=\"kr\">const</span><span class=\"w\"> </span><span class=\"kr\">char</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">sketchName</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">&quot;data_saving.ino&quot;</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-92\" name=\"l-92\"></a><span class=\"linenos\"> 92</span><span class=\"c1\">// Logger ID, also becomes the prefix for the name of the data file on SD card</span>\n</div><div class=\"line\"><a id=\"l-93\" name=\"l-93\"></a><span class=\"linenos\"> 93</span><span class=\"kr\">const</span><span class=\"w\"> </span><span class=\"kr\">char</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">LoggerID</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">&quot;XXXXX&quot;</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-94\" name=\"l-94\"></a><span class=\"linenos\"> 94</span><span class=\"c1\">// How frequently (in minutes) to log data</span>\n</div><div class=\"line\"><a id=\"l-95\" name=\"l-95\"></a><span class=\"linenos\"> 95</span><span class=\"kr\">const</span><span class=\"w\"> </span><span class=\"kr\">uint8_t</span><span class=\"w\"> </span><span class=\"n\">loggingInterval</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">15</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-96\" name=\"l-96\"></a><span class=\"linenos\"> 96</span><span class=\"c1\">// Your logger&#39;s timezone.</span>\n</div><div class=\"line\"><a id=\"l-97\" name=\"l-97\"></a><span class=\"linenos\"> 97</span><span class=\"kr\">const</span><span class=\"w\"> </span><span class=\"kr\">int8_t</span><span class=\"w\"> </span><span class=\"n\">timeZone</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">-5</span><span class=\"p\">;</span><span class=\"w\">  </span><span class=\"c1\">// Eastern Standard Time</span>\n</div><div class=\"line\"><a id=\"l-98\" name=\"l-98\"></a><span class=\"linenos\"> 98</span><span class=\"c1\">// NOTE:  Daylight savings time will not be applied!  Please use standard time!</span>\n</div><div class=\"line\"><a id=\"l-99\" name=\"l-99\"></a><span class=\"linenos\"> 99</span>\n</div><div class=\"line\"><a id=\"l-100\" name=\"l-100\"></a><span class=\"linenos\">100</span><span class=\"c1\">// Set the input and output pins for the logger</span>\n</div><div class=\"line\"><a id=\"l-101\" name=\"l-101\"></a><span class=\"linenos\">101</span><span class=\"c1\">// NOTE:  Use -1 for pins that do not apply</span>\n</div><div class=\"line\"><a id=\"l-102\" name=\"l-102\"></a><span class=\"linenos\">102</span><span class=\"kr\">const</span><span class=\"w\"> </span><span class=\"kr\">int32_t</span><span class=\"w\"> </span><span class=\"n\">serialBaud</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">115200</span><span class=\"p\">;</span><span class=\"w\">  </span><span class=\"c1\">// Baud rate for debugging</span>\n</div><div class=\"line\"><a id=\"l-103\" name=\"l-103\"></a><span class=\"linenos\">103</span><span class=\"kr\">const</span><span class=\"w\"> </span><span class=\"kr\">int8_t</span><span class=\"w\">  </span><span class=\"n\">greenLED</span><span class=\"w\">   </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"p\">;</span><span class=\"w\">       </span><span class=\"c1\">// Pin for the green LED</span>\n</div><div class=\"line\"><a id=\"l-104\" name=\"l-104\"></a><span class=\"linenos\">104</span><span class=\"kr\">const</span><span class=\"w\"> </span><span class=\"kr\">int8_t</span><span class=\"w\">  </span><span class=\"n\">redLED</span><span class=\"w\">     </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">9</span><span class=\"p\">;</span><span class=\"w\">       </span><span class=\"c1\">// Pin for the red LED</span>\n</div><div class=\"line\"><a id=\"l-105\" name=\"l-105\"></a><span class=\"linenos\">105</span><span class=\"kr\">const</span><span class=\"w\"> </span><span class=\"kr\">int8_t</span><span class=\"w\">  </span><span class=\"n\">buttonPin</span><span class=\"w\">  </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">21</span><span class=\"p\">;</span><span class=\"w\">      </span><span class=\"c1\">// Pin for debugging mode (ie, button pin)</span>\n</div><div class=\"line\"><a id=\"l-106\" name=\"l-106\"></a><span class=\"linenos\">106</span><span class=\"kr\">const</span><span class=\"w\"> </span><span class=\"kr\">int8_t</span><span class=\"w\">  </span><span class=\"n\">wakePin</span><span class=\"w\">    </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">31</span><span class=\"p\">;</span><span class=\"w\">  </span><span class=\"c1\">// MCU interrupt/alarm pin to wake from sleep</span>\n</div><div class=\"line\"><a id=\"l-107\" name=\"l-107\"></a><span class=\"linenos\">107</span><span class=\"c1\">// Mayfly 0.x D31 = A7</span>\n</div><div class=\"line\"><a id=\"l-108\" name=\"l-108\"></a><span class=\"linenos\">108</span><span class=\"c1\">// Set the wake pin to -1 if you do not want the main processor to sleep.</span>\n</div><div class=\"line\"><a id=\"l-109\" name=\"l-109\"></a><span class=\"linenos\">109</span><span class=\"c1\">// In a SAMD system where you are using the built-in rtc, set wakePin to 1</span>\n</div><div class=\"line\"><a id=\"l-110\" name=\"l-110\"></a><span class=\"linenos\">110</span><span class=\"kr\">const</span><span class=\"w\"> </span><span class=\"kr\">int8_t</span><span class=\"w\"> </span><span class=\"n\">sdCardPwrPin</span><span class=\"w\">   </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">-1</span><span class=\"p\">;</span><span class=\"w\">  </span><span class=\"c1\">// MCU SD card power pin</span>\n</div><div class=\"line\"><a id=\"l-111\" name=\"l-111\"></a><span class=\"linenos\">111</span><span class=\"kr\">const</span><span class=\"w\"> </span><span class=\"kr\">int8_t</span><span class=\"w\"> </span><span class=\"n\">sdCardSSPin</span><span class=\"w\">    </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">12</span><span class=\"p\">;</span><span class=\"w\">  </span><span class=\"c1\">// SD card chip select/slave select pin</span>\n</div><div class=\"line\"><a id=\"l-112\" name=\"l-112\"></a><span class=\"linenos\">112</span><span class=\"kr\">const</span><span class=\"w\"> </span><span class=\"kr\">int8_t</span><span class=\"w\"> </span><span class=\"n\">sensorPowerPin</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">22</span><span class=\"p\">;</span><span class=\"w\">  </span><span class=\"c1\">// MCU pin controlling main sensor power</span>\n</div><div class=\"line\"><a id=\"l-113\" name=\"l-113\"></a><span class=\"linenos\">113</span><span class=\"cm\">/** End [logging_options] */</span>\n</div><div class=\"line\"><a id=\"l-114\" name=\"l-114\"></a><span class=\"linenos\">114</span>\n</div><div class=\"line\"><a id=\"l-115\" name=\"l-115\"></a><span class=\"linenos\">115</span>\n</div><div class=\"line\"><a id=\"l-116\" name=\"l-116\"></a><span class=\"linenos\">116</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-117\" name=\"l-117\"></a><span class=\"linenos\">117</span><span class=\"c1\">//  Wifi/Cellular Modem Options</span>\n</div><div class=\"line\"><a id=\"l-118\" name=\"l-118\"></a><span class=\"linenos\">118</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-119\" name=\"l-119\"></a><span class=\"linenos\">119</span><span class=\"cm\">/** Start [sodaq_2g_bee_r6] */</span>\n</div><div class=\"line\"><a id=\"l-120\" name=\"l-120\"></a><span class=\"linenos\">120</span><span class=\"c1\">// For the Sodaq 2GBee R6 and R7 based on the SIMCom SIM800</span>\n</div><div class=\"line\"><a id=\"l-121\" name=\"l-121\"></a><span class=\"linenos\">121</span><span class=\"c1\">// NOTE:  The Sodaq GPRSBee doesn&#39;t expose the SIM800&#39;s reset pin</span>\n</div><div class=\"line\"><a id=\"l-122\" name=\"l-122\"></a><span class=\"linenos\">122</span><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;modems/Sodaq2GBeeR6.h&gt;</span>\n</div><div class=\"line\"><a id=\"l-123\" name=\"l-123\"></a><span class=\"linenos\">123</span><span class=\"c1\">// Create a reference to the serial port for the modem</span>\n</div><div class=\"line\"><a id=\"l-124\" name=\"l-124\"></a><span class=\"linenos\">124</span><span class=\"n\">HardwareSerial</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">modemSerial</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Serial1</span><span class=\"p\">;</span><span class=\"w\">  </span><span class=\"c1\">// Use hardware serial if possible</span>\n</div><div class=\"line\"><a id=\"l-125\" name=\"l-125\"></a><span class=\"linenos\">125</span><span class=\"kr\">const</span><span class=\"w\"> </span><span class=\"kr\">int32_t</span><span class=\"w\">   </span><span class=\"n\">modemBaud</span><span class=\"w\">   </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">9600</span><span class=\"p\">;</span><span class=\"w\">     </span><span class=\"c1\">//  SIM800 does auto-bauding by default</span>\n</div><div class=\"line\"><a id=\"l-126\" name=\"l-126\"></a><span class=\"linenos\">126</span>\n</div><div class=\"line\"><a id=\"l-127\" name=\"l-127\"></a><span class=\"linenos\">127</span><span class=\"c1\">// Modem Pins - Describe the physical pin connection of your modem to your board</span>\n</div><div class=\"line\"><a id=\"l-128\" name=\"l-128\"></a><span class=\"linenos\">128</span><span class=\"c1\">// NOTE:  Use -1 for pins that do not apply</span>\n</div><div class=\"line\"><a id=\"l-129\" name=\"l-129\"></a><span class=\"linenos\">129</span><span class=\"kr\">const</span><span class=\"w\"> </span><span class=\"kr\">int8_t</span><span class=\"w\"> </span><span class=\"n\">modemVccPin</span><span class=\"w\">    </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">23</span><span class=\"p\">;</span><span class=\"w\">      </span><span class=\"c1\">// MCU pin controlling modem power</span>\n</div><div class=\"line\"><a id=\"l-130\" name=\"l-130\"></a><span class=\"linenos\">130</span><span class=\"kr\">const</span><span class=\"w\"> </span><span class=\"kr\">int8_t</span><span class=\"w\"> </span><span class=\"n\">modemStatusPin</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">19</span><span class=\"p\">;</span><span class=\"w\">      </span><span class=\"c1\">// MCU pin used to read modem status</span>\n</div><div class=\"line\"><a id=\"l-131\" name=\"l-131\"></a><span class=\"linenos\">131</span><span class=\"kr\">const</span><span class=\"w\"> </span><span class=\"kr\">int8_t</span><span class=\"w\"> </span><span class=\"n\">modemLEDPin</span><span class=\"w\">    </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">redLED</span><span class=\"p\">;</span><span class=\"w\">  </span><span class=\"c1\">// MCU pin connected an LED to show modem</span>\n</div><div class=\"line\"><a id=\"l-132\" name=\"l-132\"></a><span class=\"linenos\">132</span><span class=\"w\">                                       </span><span class=\"c1\">// status (-1 if unconnected)</span>\n</div><div class=\"line\"><a id=\"l-133\" name=\"l-133\"></a><span class=\"linenos\">133</span>\n</div><div class=\"line\"><a id=\"l-134\" name=\"l-134\"></a><span class=\"linenos\">134</span><span class=\"c1\">// Network connection information</span>\n</div><div class=\"line\"><a id=\"l-135\" name=\"l-135\"></a><span class=\"linenos\">135</span><span class=\"kr\">const</span><span class=\"w\"> </span><span class=\"kr\">char</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">apn</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">&quot;xxxxx&quot;</span><span class=\"p\">;</span><span class=\"w\">  </span><span class=\"c1\">// The APN for the gprs connection</span>\n</div><div class=\"line\"><a id=\"l-136\" name=\"l-136\"></a><span class=\"linenos\">136</span>\n</div><div class=\"line\"><a id=\"l-137\" name=\"l-137\"></a><span class=\"linenos\">137</span><span class=\"n\">Sodaq2GBeeR6</span><span class=\"w\"> </span><span class=\"nf\">modem2GB</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">modemSerial</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">modemVccPin</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">modemStatusPin</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">apn</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-138\" name=\"l-138\"></a><span class=\"linenos\">138</span><span class=\"c1\">// Create an extra reference to the modem by a generic name</span>\n</div><div class=\"line\"><a id=\"l-139\" name=\"l-139\"></a><span class=\"linenos\">139</span><span class=\"n\">Sodaq2GBeeR6</span><span class=\"w\"> </span><span class=\"n\">modem</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">modem2GB</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-140\" name=\"l-140\"></a><span class=\"linenos\">140</span>\n</div><div class=\"line\"><a id=\"l-141\" name=\"l-141\"></a><span class=\"linenos\">141</span><span class=\"c1\">// Create RSSI and signal strength variable pointers for the modem</span>\n</div><div class=\"line\"><a id=\"l-142\" name=\"l-142\"></a><span class=\"linenos\">142</span><span class=\"n\">Variable</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">modemRSSI</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"n\">Modem_RSSI</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">modem</span><span class=\"p\">,</span>\n</div><div class=\"line\"><a id=\"l-143\" name=\"l-143\"></a><span class=\"linenos\">143</span><span class=\"w\">                                     </span><span class=\"s\">&quot;12345678-abcd-1234-ef00-1234567890ab&quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-144\" name=\"l-144\"></a><span class=\"linenos\">144</span><span class=\"n\">Variable</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">modemSignalPct</span><span class=\"w\"> </span><span class=\"o\">=</span>\n</div><div class=\"line\"><a id=\"l-145\" name=\"l-145\"></a><span class=\"linenos\">145</span><span class=\"w\">    </span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"n\">Modem_SignalPercent</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">modem</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;12345678-abcd-1234-ef00-1234567890ab&quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-146\" name=\"l-146\"></a><span class=\"linenos\">146</span><span class=\"cm\">/** End [sodaq_2g_bee_r6] */</span>\n</div><div class=\"line\"><a id=\"l-147\" name=\"l-147\"></a><span class=\"linenos\">147</span>\n</div><div class=\"line\"><a id=\"l-148\" name=\"l-148\"></a><span class=\"linenos\">148</span>\n</div><div class=\"line\"><a id=\"l-149\" name=\"l-149\"></a><span class=\"linenos\">149</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-150\" name=\"l-150\"></a><span class=\"linenos\">150</span><span class=\"c1\">//  Using the Processor as a Sensor</span>\n</div><div class=\"line\"><a id=\"l-151\" name=\"l-151\"></a><span class=\"linenos\">151</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-152\" name=\"l-152\"></a><span class=\"linenos\">152</span><span class=\"cm\">/** Start [processor_sensor] */</span>\n</div><div class=\"line\"><a id=\"l-153\" name=\"l-153\"></a><span class=\"linenos\">153</span><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;sensors/ProcessorStats.h&gt;</span>\n</div><div class=\"line\"><a id=\"l-154\" name=\"l-154\"></a><span class=\"linenos\">154</span>\n</div><div class=\"line\"><a id=\"l-155\" name=\"l-155\"></a><span class=\"linenos\">155</span><span class=\"c1\">// Create the main processor chip &quot;sensor&quot; - for general metadata</span>\n</div><div class=\"line\"><a id=\"l-156\" name=\"l-156\"></a><span class=\"linenos\">156</span><span class=\"kr\">const</span><span class=\"w\"> </span><span class=\"kr\">char</span><span class=\"o\">*</span><span class=\"w\">    </span><span class=\"n\">mcuBoardVersion</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">&quot;v1.1&quot;</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-157\" name=\"l-157\"></a><span class=\"linenos\">157</span><span class=\"n\">ProcessorStats</span><span class=\"w\"> </span><span class=\"nf\">mcuBoard</span><span class=\"p\">(</span><span class=\"n\">mcuBoardVersion</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-158\" name=\"l-158\"></a><span class=\"linenos\">158</span>\n</div><div class=\"line\"><a id=\"l-159\" name=\"l-159\"></a><span class=\"linenos\">159</span><span class=\"c1\">// Create sample number, battery voltage, and free RAM variable pointers for the</span>\n</div><div class=\"line\"><a id=\"l-160\" name=\"l-160\"></a><span class=\"linenos\">160</span><span class=\"c1\">// processor</span>\n</div><div class=\"line\"><a id=\"l-161\" name=\"l-161\"></a><span class=\"linenos\">161</span><span class=\"n\">Variable</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">mcuBoardBatt</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"n\">ProcessorStats_Battery</span><span class=\"p\">(</span>\n</div><div class=\"line\"><a id=\"l-162\" name=\"l-162\"></a><span class=\"linenos\">162</span><span class=\"w\">    </span><span class=\"o\">&amp;</span><span class=\"n\">mcuBoard</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;12345678-abcd-1234-ef00-1234567890ab&quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-163\" name=\"l-163\"></a><span class=\"linenos\">163</span><span class=\"n\">Variable</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">mcuBoardAvailableRAM</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"n\">ProcessorStats_FreeRam</span><span class=\"p\">(</span>\n</div><div class=\"line\"><a id=\"l-164\" name=\"l-164\"></a><span class=\"linenos\">164</span><span class=\"w\">    </span><span class=\"o\">&amp;</span><span class=\"n\">mcuBoard</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;12345678-abcd-1234-ef00-1234567890ab&quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-165\" name=\"l-165\"></a><span class=\"linenos\">165</span><span class=\"n\">Variable</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">mcuBoardSampNo</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"n\">ProcessorStats_SampleNumber</span><span class=\"p\">(</span>\n</div><div class=\"line\"><a id=\"l-166\" name=\"l-166\"></a><span class=\"linenos\">166</span><span class=\"w\">    </span><span class=\"o\">&amp;</span><span class=\"n\">mcuBoard</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;12345678-abcd-1234-ef00-1234567890ab&quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-167\" name=\"l-167\"></a><span class=\"linenos\">167</span><span class=\"cm\">/** End [processor_sensor] */</span>\n</div><div class=\"line\"><a id=\"l-168\" name=\"l-168\"></a><span class=\"linenos\">168</span>\n</div><div class=\"line\"><a id=\"l-169\" name=\"l-169\"></a><span class=\"linenos\">169</span>\n</div><div class=\"line\"><a id=\"l-170\" name=\"l-170\"></a><span class=\"linenos\">170</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-171\" name=\"l-171\"></a><span class=\"linenos\">171</span><span class=\"c1\">//  Maxim DS3231 RTC (Real Time Clock)</span>\n</div><div class=\"line\"><a id=\"l-172\" name=\"l-172\"></a><span class=\"linenos\">172</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-173\" name=\"l-173\"></a><span class=\"linenos\">173</span><span class=\"cm\">/** Start [ds3231] */</span>\n</div><div class=\"line\"><a id=\"l-174\" name=\"l-174\"></a><span class=\"linenos\">174</span><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;sensors/MaximDS3231.h&gt;</span>\n</div><div class=\"line\"><a id=\"l-175\" name=\"l-175\"></a><span class=\"linenos\">175</span>\n</div><div class=\"line\"><a id=\"l-176\" name=\"l-176\"></a><span class=\"linenos\">176</span><span class=\"c1\">// Create a DS3231 sensor object</span>\n</div><div class=\"line\"><a id=\"l-177\" name=\"l-177\"></a><span class=\"linenos\">177</span><span class=\"n\">MaximDS3231</span><span class=\"w\"> </span><span class=\"nf\">ds3231</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-178\" name=\"l-178\"></a><span class=\"linenos\">178</span>\n</div><div class=\"line\"><a id=\"l-179\" name=\"l-179\"></a><span class=\"linenos\">179</span><span class=\"c1\">// Create a temperature variable pointer for the DS3231</span>\n</div><div class=\"line\"><a id=\"l-180\" name=\"l-180\"></a><span class=\"linenos\">180</span><span class=\"n\">Variable</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">ds3231Temp</span><span class=\"w\"> </span><span class=\"o\">=</span>\n</div><div class=\"line\"><a id=\"l-181\" name=\"l-181\"></a><span class=\"linenos\">181</span><span class=\"w\">    </span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"n\">MaximDS3231_Temp</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">ds3231</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;12345678-abcd-1234-ef00-1234567890ab&quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-182\" name=\"l-182\"></a><span class=\"linenos\">182</span><span class=\"cm\">/** End [ds3231] */</span>\n</div><div class=\"line\"><a id=\"l-183\" name=\"l-183\"></a><span class=\"linenos\">183</span>\n</div><div class=\"line\"><a id=\"l-184\" name=\"l-184\"></a><span class=\"linenos\">184</span>\n</div><div class=\"line\"><a id=\"l-185\" name=\"l-185\"></a><span class=\"linenos\">185</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-186\" name=\"l-186\"></a><span class=\"linenos\">186</span><span class=\"c1\">//  Settings shared between Modbus sensors</span>\n</div><div class=\"line\"><a id=\"l-187\" name=\"l-187\"></a><span class=\"linenos\">187</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-188\" name=\"l-188\"></a><span class=\"linenos\">188</span><span class=\"cm\">/** Start [modbus_shared] */</span>\n</div><div class=\"line\"><a id=\"l-189\" name=\"l-189\"></a><span class=\"linenos\">189</span><span class=\"c1\">// Create a reference to the serial port for modbus</span>\n</div><div class=\"line\"><a id=\"l-190\" name=\"l-190\"></a><span class=\"linenos\">190</span><span class=\"cp\">#if defined(ARDUINO_ARCH_SAMD) || defined(ARDUINO_SAMD_ZERO) || \\</span>\n</div><div class=\"line\"><a id=\"l-191\" name=\"l-191\"></a><span class=\"linenos\">191</span><span class=\"cp\">    defined(ATMEGA2560)</span>\n</div><div class=\"line\"><a id=\"l-192\" name=\"l-192\"></a><span class=\"linenos\">192</span><span class=\"n\">HardwareSerial</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">modbusSerial</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Serial2</span><span class=\"p\">;</span><span class=\"w\">  </span><span class=\"c1\">// Use hardware serial if possible</span>\n</div><div class=\"line\"><a id=\"l-193\" name=\"l-193\"></a><span class=\"linenos\">193</span><span class=\"cp\">#else</span>\n</div><div class=\"line\"><a id=\"l-194\" name=\"l-194\"></a><span class=\"linenos\">194</span><span class=\"n\">AltSoftSerial</span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">modbusSerial</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">altSoftSerial</span><span class=\"p\">;</span><span class=\"w\">  </span><span class=\"c1\">// For software serial</span>\n</div><div class=\"line\"><a id=\"l-195\" name=\"l-195\"></a><span class=\"linenos\">195</span><span class=\"cp\">#endif</span>\n</div><div class=\"line\"><a id=\"l-196\" name=\"l-196\"></a><span class=\"linenos\">196</span>\n</div><div class=\"line\"><a id=\"l-197\" name=\"l-197\"></a><span class=\"linenos\">197</span><span class=\"c1\">// Define some pins that will be shared by all modbus sensors</span>\n</div><div class=\"line\"><a id=\"l-198\" name=\"l-198\"></a><span class=\"linenos\">198</span><span class=\"kr\">const</span><span class=\"w\"> </span><span class=\"kr\">int8_t</span><span class=\"w\"> </span><span class=\"n\">rs485AdapterPower</span><span class=\"w\"> </span><span class=\"o\">=</span>\n</div><div class=\"line\"><a id=\"l-199\" name=\"l-199\"></a><span class=\"linenos\">199</span><span class=\"w\">    </span><span class=\"n\">sensorPowerPin</span><span class=\"p\">;</span><span class=\"w\">  </span><span class=\"c1\">// RS485 adapter power pin (-1 if unconnected)</span>\n</div><div class=\"line\"><a id=\"l-200\" name=\"l-200\"></a><span class=\"linenos\">200</span><span class=\"kr\">const</span><span class=\"w\"> </span><span class=\"kr\">int8_t</span><span class=\"w\"> </span><span class=\"n\">modbusSensorPower</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">A3</span><span class=\"p\">;</span><span class=\"w\">  </span><span class=\"c1\">// Sensor power pin</span>\n</div><div class=\"line\"><a id=\"l-201\" name=\"l-201\"></a><span class=\"linenos\">201</span><span class=\"kr\">const</span><span class=\"w\"> </span><span class=\"kr\">int8_t</span><span class=\"w\"> </span><span class=\"n\">rs485EnablePin</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">-1</span><span class=\"p\">;</span><span class=\"w\">  </span><span class=\"c1\">// Adapter RE/DE pin (-1 if not applicable)</span>\n</div><div class=\"line\"><a id=\"l-202\" name=\"l-202\"></a><span class=\"linenos\">202</span><span class=\"cm\">/** End [modbus_shared] */</span>\n</div><div class=\"line\"><a id=\"l-203\" name=\"l-203\"></a><span class=\"linenos\">203</span>\n</div><div class=\"line\"><a id=\"l-204\" name=\"l-204\"></a><span class=\"linenos\">204</span>\n</div><div class=\"line\"><a id=\"l-205\" name=\"l-205\"></a><span class=\"linenos\">205</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-206\" name=\"l-206\"></a><span class=\"linenos\">206</span><span class=\"c1\">//  Yosemitech Y504 Dissolved Oxygen Sensor</span>\n</div><div class=\"line\"><a id=\"l-207\" name=\"l-207\"></a><span class=\"linenos\">207</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-208\" name=\"l-208\"></a><span class=\"linenos\">208</span><span class=\"cm\">/** Start [Y504] */</span>\n</div><div class=\"line\"><a id=\"l-209\" name=\"l-209\"></a><span class=\"linenos\">209</span><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;sensors/YosemitechY504.h&gt;</span>\n</div><div class=\"line\"><a id=\"l-210\" name=\"l-210\"></a><span class=\"linenos\">210</span>\n</div><div class=\"line\"><a id=\"l-211\" name=\"l-211\"></a><span class=\"linenos\">211</span><span class=\"kr\">byte</span><span class=\"w\">          </span><span class=\"n\">y504ModbusAddress</span><span class=\"w\">  </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mh\">0x04</span><span class=\"p\">;</span><span class=\"w\">  </span><span class=\"c1\">// The modbus address of the Y504</span>\n</div><div class=\"line\"><a id=\"l-212\" name=\"l-212\"></a><span class=\"linenos\">212</span><span class=\"kr\">const</span><span class=\"w\"> </span><span class=\"kr\">uint8_t</span><span class=\"w\"> </span><span class=\"n\">y504NumberReadings</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-213\" name=\"l-213\"></a><span class=\"linenos\">213</span><span class=\"c1\">// The manufacturer recommends averaging 10 readings, but we take 5 to minimize</span>\n</div><div class=\"line\"><a id=\"l-214\" name=\"l-214\"></a><span class=\"linenos\">214</span><span class=\"c1\">// power consumption</span>\n</div><div class=\"line\"><a id=\"l-215\" name=\"l-215\"></a><span class=\"linenos\">215</span>\n</div><div class=\"line\"><a id=\"l-216\" name=\"l-216\"></a><span class=\"linenos\">216</span><span class=\"c1\">// Create a Yosemitech Y504 dissolved oxygen sensor object</span>\n</div><div class=\"line\"><a id=\"l-217\" name=\"l-217\"></a><span class=\"linenos\">217</span><span class=\"n\">YosemitechY504</span><span class=\"w\"> </span><span class=\"nf\">y504</span><span class=\"p\">(</span><span class=\"n\">y504ModbusAddress</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">modbusSerial</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rs485AdapterPower</span><span class=\"p\">,</span>\n</div><div class=\"line\"><a id=\"l-218\" name=\"l-218\"></a><span class=\"linenos\">218</span><span class=\"w\">                    </span><span class=\"n\">modbusSensorPower</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rs485EnablePin</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">y504NumberReadings</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-219\" name=\"l-219\"></a><span class=\"linenos\">219</span>\n</div><div class=\"line\"><a id=\"l-220\" name=\"l-220\"></a><span class=\"linenos\">220</span><span class=\"c1\">// Create the dissolved oxygen percent, dissolved oxygen concentration, and</span>\n</div><div class=\"line\"><a id=\"l-221\" name=\"l-221\"></a><span class=\"linenos\">221</span><span class=\"c1\">// temperature variable pointers for the Y504</span>\n</div><div class=\"line\"><a id=\"l-222\" name=\"l-222\"></a><span class=\"linenos\">222</span><span class=\"n\">Variable</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">y504DOpct</span><span class=\"w\"> </span><span class=\"o\">=</span>\n</div><div class=\"line\"><a id=\"l-223\" name=\"l-223\"></a><span class=\"linenos\">223</span><span class=\"w\">    </span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"n\">YosemitechY504_DOpct</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">y504</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;12345678-abcd-1234-ef00-1234567890ab&quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-224\" name=\"l-224\"></a><span class=\"linenos\">224</span><span class=\"n\">Variable</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">y504DOmgL</span><span class=\"w\"> </span><span class=\"o\">=</span>\n</div><div class=\"line\"><a id=\"l-225\" name=\"l-225\"></a><span class=\"linenos\">225</span><span class=\"w\">    </span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"n\">YosemitechY504_DOmgL</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">y504</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;12345678-abcd-1234-ef00-1234567890ab&quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-226\" name=\"l-226\"></a><span class=\"linenos\">226</span><span class=\"n\">Variable</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">y504Temp</span><span class=\"w\"> </span><span class=\"o\">=</span>\n</div><div class=\"line\"><a id=\"l-227\" name=\"l-227\"></a><span class=\"linenos\">227</span><span class=\"w\">    </span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"n\">YosemitechY504_Temp</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">y504</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;12345678-abcd-1234-ef00-1234567890ab&quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-228\" name=\"l-228\"></a><span class=\"linenos\">228</span><span class=\"cm\">/** End [Y504] */</span>\n</div><div class=\"line\"><a id=\"l-229\" name=\"l-229\"></a><span class=\"linenos\">229</span>\n</div><div class=\"line\"><a id=\"l-230\" name=\"l-230\"></a><span class=\"linenos\">230</span>\n</div><div class=\"line\"><a id=\"l-231\" name=\"l-231\"></a><span class=\"linenos\">231</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-232\" name=\"l-232\"></a><span class=\"linenos\">232</span><span class=\"c1\">//  Yosemitech Y511 Turbidity Sensor with Wiper</span>\n</div><div class=\"line\"><a id=\"l-233\" name=\"l-233\"></a><span class=\"linenos\">233</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-234\" name=\"l-234\"></a><span class=\"linenos\">234</span><span class=\"cm\">/** Start [Y511] */</span>\n</div><div class=\"line\"><a id=\"l-235\" name=\"l-235\"></a><span class=\"linenos\">235</span><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;sensors/YosemitechY511.h&gt;</span>\n</div><div class=\"line\"><a id=\"l-236\" name=\"l-236\"></a><span class=\"linenos\">236</span>\n</div><div class=\"line\"><a id=\"l-237\" name=\"l-237\"></a><span class=\"linenos\">237</span><span class=\"kr\">byte</span><span class=\"w\">          </span><span class=\"n\">y511ModbusAddress</span><span class=\"w\">  </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mh\">0x1A</span><span class=\"p\">;</span><span class=\"w\">  </span><span class=\"c1\">// The modbus address of the Y511</span>\n</div><div class=\"line\"><a id=\"l-238\" name=\"l-238\"></a><span class=\"linenos\">238</span><span class=\"kr\">const</span><span class=\"w\"> </span><span class=\"kr\">uint8_t</span><span class=\"w\"> </span><span class=\"n\">y511NumberReadings</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-239\" name=\"l-239\"></a><span class=\"linenos\">239</span><span class=\"c1\">// The manufacturer recommends averaging 10 readings, but we take 5 to minimize</span>\n</div><div class=\"line\"><a id=\"l-240\" name=\"l-240\"></a><span class=\"linenos\">240</span><span class=\"c1\">// power consumption</span>\n</div><div class=\"line\"><a id=\"l-241\" name=\"l-241\"></a><span class=\"linenos\">241</span>\n</div><div class=\"line\"><a id=\"l-242\" name=\"l-242\"></a><span class=\"linenos\">242</span><span class=\"c1\">// Create a Y511-A Turbidity sensor object</span>\n</div><div class=\"line\"><a id=\"l-243\" name=\"l-243\"></a><span class=\"linenos\">243</span><span class=\"n\">YosemitechY511</span><span class=\"w\"> </span><span class=\"nf\">y511</span><span class=\"p\">(</span><span class=\"n\">y511ModbusAddress</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">modbusSerial</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rs485AdapterPower</span><span class=\"p\">,</span>\n</div><div class=\"line\"><a id=\"l-244\" name=\"l-244\"></a><span class=\"linenos\">244</span><span class=\"w\">                    </span><span class=\"n\">modbusSensorPower</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rs485EnablePin</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">y511NumberReadings</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-245\" name=\"l-245\"></a><span class=\"linenos\">245</span>\n</div><div class=\"line\"><a id=\"l-246\" name=\"l-246\"></a><span class=\"linenos\">246</span><span class=\"c1\">// Create turbidity and temperature variable pointers for the Y511</span>\n</div><div class=\"line\"><a id=\"l-247\" name=\"l-247\"></a><span class=\"linenos\">247</span><span class=\"n\">Variable</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">y511Turb</span><span class=\"w\"> </span><span class=\"o\">=</span>\n</div><div class=\"line\"><a id=\"l-248\" name=\"l-248\"></a><span class=\"linenos\">248</span><span class=\"w\">    </span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"n\">YosemitechY511_Turbidity</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">y511</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;12345678-abcd-1234-ef00-1234567890ab&quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-249\" name=\"l-249\"></a><span class=\"linenos\">249</span><span class=\"n\">Variable</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">y511Temp</span><span class=\"w\"> </span><span class=\"o\">=</span>\n</div><div class=\"line\"><a id=\"l-250\" name=\"l-250\"></a><span class=\"linenos\">250</span><span class=\"w\">    </span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"n\">YosemitechY511_Temp</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">y511</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;12345678-abcd-1234-ef00-1234567890ab&quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-251\" name=\"l-251\"></a><span class=\"linenos\">251</span><span class=\"cm\">/** End [Y511] */</span>\n</div><div class=\"line\"><a id=\"l-252\" name=\"l-252\"></a><span class=\"linenos\">252</span>\n</div><div class=\"line\"><a id=\"l-253\" name=\"l-253\"></a><span class=\"linenos\">253</span>\n</div><div class=\"line\"><a id=\"l-254\" name=\"l-254\"></a><span class=\"linenos\">254</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-255\" name=\"l-255\"></a><span class=\"linenos\">255</span><span class=\"c1\">//  Yosemitech Y514 Chlorophyll Sensor</span>\n</div><div class=\"line\"><a id=\"l-256\" name=\"l-256\"></a><span class=\"linenos\">256</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-257\" name=\"l-257\"></a><span class=\"linenos\">257</span><span class=\"cm\">/** Start [Y514] */</span>\n</div><div class=\"line\"><a id=\"l-258\" name=\"l-258\"></a><span class=\"linenos\">258</span><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;sensors/YosemitechY514.h&gt;</span>\n</div><div class=\"line\"><a id=\"l-259\" name=\"l-259\"></a><span class=\"linenos\">259</span>\n</div><div class=\"line\"><a id=\"l-260\" name=\"l-260\"></a><span class=\"linenos\">260</span><span class=\"kr\">byte</span><span class=\"w\">          </span><span class=\"n\">y514ModbusAddress</span><span class=\"w\">  </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mh\">0x14</span><span class=\"p\">;</span><span class=\"w\">  </span><span class=\"c1\">// The modbus address of the Y514</span>\n</div><div class=\"line\"><a id=\"l-261\" name=\"l-261\"></a><span class=\"linenos\">261</span><span class=\"kr\">const</span><span class=\"w\"> </span><span class=\"kr\">uint8_t</span><span class=\"w\"> </span><span class=\"n\">y514NumberReadings</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-262\" name=\"l-262\"></a><span class=\"linenos\">262</span><span class=\"c1\">// The manufacturer recommends averaging 10 readings, but we take 5 to</span>\n</div><div class=\"line\"><a id=\"l-263\" name=\"l-263\"></a><span class=\"linenos\">263</span><span class=\"c1\">// minimize power consumption</span>\n</div><div class=\"line\"><a id=\"l-264\" name=\"l-264\"></a><span class=\"linenos\">264</span>\n</div><div class=\"line\"><a id=\"l-265\" name=\"l-265\"></a><span class=\"linenos\">265</span><span class=\"c1\">// Create a Y514 chlorophyll sensor object</span>\n</div><div class=\"line\"><a id=\"l-266\" name=\"l-266\"></a><span class=\"linenos\">266</span><span class=\"n\">YosemitechY514</span><span class=\"w\"> </span><span class=\"nf\">y514</span><span class=\"p\">(</span><span class=\"n\">y514ModbusAddress</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">modbusSerial</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rs485AdapterPower</span><span class=\"p\">,</span>\n</div><div class=\"line\"><a id=\"l-267\" name=\"l-267\"></a><span class=\"linenos\">267</span><span class=\"w\">                    </span><span class=\"n\">modbusSensorPower</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rs485EnablePin</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">y514NumberReadings</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-268\" name=\"l-268\"></a><span class=\"linenos\">268</span>\n</div><div class=\"line\"><a id=\"l-269\" name=\"l-269\"></a><span class=\"linenos\">269</span><span class=\"c1\">// Create chlorophyll concentration and temperature variable pointers for the</span>\n</div><div class=\"line\"><a id=\"l-270\" name=\"l-270\"></a><span class=\"linenos\">270</span><span class=\"c1\">// Y514</span>\n</div><div class=\"line\"><a id=\"l-271\" name=\"l-271\"></a><span class=\"linenos\">271</span><span class=\"n\">Variable</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">y514Chloro</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"n\">YosemitechY514_Chlorophyll</span><span class=\"p\">(</span>\n</div><div class=\"line\"><a id=\"l-272\" name=\"l-272\"></a><span class=\"linenos\">272</span><span class=\"w\">    </span><span class=\"o\">&amp;</span><span class=\"n\">y514</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;12345678-abcd-1234-ef00-1234567890ab&quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-273\" name=\"l-273\"></a><span class=\"linenos\">273</span><span class=\"n\">Variable</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">y514Temp</span><span class=\"w\"> </span><span class=\"o\">=</span>\n</div><div class=\"line\"><a id=\"l-274\" name=\"l-274\"></a><span class=\"linenos\">274</span><span class=\"w\">    </span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"n\">YosemitechY514_Temp</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">y514</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;12345678-abcd-1234-ef00-1234567890ab&quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-275\" name=\"l-275\"></a><span class=\"linenos\">275</span><span class=\"cm\">/** End [Y514] */</span>\n</div><div class=\"line\"><a id=\"l-276\" name=\"l-276\"></a><span class=\"linenos\">276</span>\n</div><div class=\"line\"><a id=\"l-277\" name=\"l-277\"></a><span class=\"linenos\">277</span>\n</div><div class=\"line\"><a id=\"l-278\" name=\"l-278\"></a><span class=\"linenos\">278</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-279\" name=\"l-279\"></a><span class=\"linenos\">279</span><span class=\"c1\">//  Yosemitech Y520 Conductivity Sensor</span>\n</div><div class=\"line\"><a id=\"l-280\" name=\"l-280\"></a><span class=\"linenos\">280</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-281\" name=\"l-281\"></a><span class=\"linenos\">281</span><span class=\"cm\">/** Start [Y520] */</span>\n</div><div class=\"line\"><a id=\"l-282\" name=\"l-282\"></a><span class=\"linenos\">282</span><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;sensors/YosemitechY520.h&gt;</span>\n</div><div class=\"line\"><a id=\"l-283\" name=\"l-283\"></a><span class=\"linenos\">283</span>\n</div><div class=\"line\"><a id=\"l-284\" name=\"l-284\"></a><span class=\"linenos\">284</span><span class=\"kr\">byte</span><span class=\"w\">          </span><span class=\"n\">y520ModbusAddress</span><span class=\"w\">  </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mh\">0x20</span><span class=\"p\">;</span><span class=\"w\">  </span><span class=\"c1\">// The modbus address of the Y520</span>\n</div><div class=\"line\"><a id=\"l-285\" name=\"l-285\"></a><span class=\"linenos\">285</span><span class=\"kr\">const</span><span class=\"w\"> </span><span class=\"kr\">uint8_t</span><span class=\"w\"> </span><span class=\"n\">y520NumberReadings</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-286\" name=\"l-286\"></a><span class=\"linenos\">286</span><span class=\"c1\">// The manufacturer recommends averaging 10 readings, but we take 5 to minimize</span>\n</div><div class=\"line\"><a id=\"l-287\" name=\"l-287\"></a><span class=\"linenos\">287</span><span class=\"c1\">// power consumption</span>\n</div><div class=\"line\"><a id=\"l-288\" name=\"l-288\"></a><span class=\"linenos\">288</span>\n</div><div class=\"line\"><a id=\"l-289\" name=\"l-289\"></a><span class=\"linenos\">289</span><span class=\"c1\">// Create a Y520 conductivity sensor object</span>\n</div><div class=\"line\"><a id=\"l-290\" name=\"l-290\"></a><span class=\"linenos\">290</span><span class=\"n\">YosemitechY520</span><span class=\"w\"> </span><span class=\"nf\">y520</span><span class=\"p\">(</span><span class=\"n\">y520ModbusAddress</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">modbusSerial</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rs485AdapterPower</span><span class=\"p\">,</span>\n</div><div class=\"line\"><a id=\"l-291\" name=\"l-291\"></a><span class=\"linenos\">291</span><span class=\"w\">                    </span><span class=\"n\">modbusSensorPower</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rs485EnablePin</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">y520NumberReadings</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-292\" name=\"l-292\"></a><span class=\"linenos\">292</span>\n</div><div class=\"line\"><a id=\"l-293\" name=\"l-293\"></a><span class=\"linenos\">293</span><span class=\"c1\">// Create specific conductance and temperature variable pointers for the Y520</span>\n</div><div class=\"line\"><a id=\"l-294\" name=\"l-294\"></a><span class=\"linenos\">294</span><span class=\"n\">Variable</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">y520Cond</span><span class=\"w\"> </span><span class=\"o\">=</span>\n</div><div class=\"line\"><a id=\"l-295\" name=\"l-295\"></a><span class=\"linenos\">295</span><span class=\"w\">    </span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"n\">YosemitechY520_Cond</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">y520</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;12345678-abcd-1234-ef00-1234567890ab&quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-296\" name=\"l-296\"></a><span class=\"linenos\">296</span><span class=\"n\">Variable</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">y520Temp</span><span class=\"w\"> </span><span class=\"o\">=</span>\n</div><div class=\"line\"><a id=\"l-297\" name=\"l-297\"></a><span class=\"linenos\">297</span><span class=\"w\">    </span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"n\">YosemitechY520_Temp</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">y520</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;12345678-abcd-1234-ef00-1234567890ab&quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-298\" name=\"l-298\"></a><span class=\"linenos\">298</span><span class=\"cm\">/** End [Y520] */</span>\n</div><div class=\"line\"><a id=\"l-299\" name=\"l-299\"></a><span class=\"linenos\">299</span>\n</div><div class=\"line\"><a id=\"l-300\" name=\"l-300\"></a><span class=\"linenos\">300</span>\n</div><div class=\"line\"><a id=\"l-301\" name=\"l-301\"></a><span class=\"linenos\">301</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-302\" name=\"l-302\"></a><span class=\"linenos\">302</span><span class=\"c1\">//  Creating the Variable Array[s] and Filling with Variable Objects</span>\n</div><div class=\"line\"><a id=\"l-303\" name=\"l-303\"></a><span class=\"linenos\">303</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-304\" name=\"l-304\"></a><span class=\"linenos\">304</span><span class=\"cm\">/** Start [variable_arrays] */</span>\n</div><div class=\"line\"><a id=\"l-305\" name=\"l-305\"></a><span class=\"linenos\">305</span><span class=\"c1\">// FORM2: Fill array with already created and named variable pointers</span>\n</div><div class=\"line\"><a id=\"l-306\" name=\"l-306\"></a><span class=\"linenos\">306</span><span class=\"c1\">// We put ALL of the variable pointers into the first array</span>\n</div><div class=\"line\"><a id=\"l-307\" name=\"l-307\"></a><span class=\"linenos\">307</span><span class=\"n\">Variable</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">variableList_complete</span><span class=\"p\">[]</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-308\" name=\"l-308\"></a><span class=\"linenos\">308</span><span class=\"w\">    </span><span class=\"n\">mcuBoardSampNo</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">mcuBoardBatt</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">mcuBoardAvailableRAM</span><span class=\"p\">,</span>\n</div><div class=\"line\"><a id=\"l-309\" name=\"l-309\"></a><span class=\"linenos\">309</span><span class=\"w\">    </span><span class=\"n\">ds3231Temp</span><span class=\"p\">,</span><span class=\"w\">     </span><span class=\"n\">y504DOpct</span><span class=\"p\">,</span><span class=\"w\">    </span><span class=\"n\">y504DOmgL</span><span class=\"p\">,</span>\n</div><div class=\"line\"><a id=\"l-310\" name=\"l-310\"></a><span class=\"linenos\">310</span><span class=\"w\">    </span><span class=\"n\">y504Temp</span><span class=\"p\">,</span><span class=\"w\">       </span><span class=\"n\">y511Turb</span><span class=\"p\">,</span><span class=\"w\">     </span><span class=\"n\">y511Temp</span><span class=\"p\">,</span>\n</div><div class=\"line\"><a id=\"l-311\" name=\"l-311\"></a><span class=\"linenos\">311</span><span class=\"w\">    </span><span class=\"n\">y514Chloro</span><span class=\"p\">,</span><span class=\"w\">     </span><span class=\"n\">y514Temp</span><span class=\"p\">,</span><span class=\"w\">     </span><span class=\"n\">y520Cond</span><span class=\"p\">,</span>\n</div><div class=\"line\"><a id=\"l-312\" name=\"l-312\"></a><span class=\"linenos\">312</span><span class=\"w\">    </span><span class=\"n\">y520Temp</span><span class=\"p\">,</span><span class=\"w\">       </span><span class=\"n\">modemRSSI</span><span class=\"p\">,</span><span class=\"w\">    </span><span class=\"n\">modemSignalPct</span><span class=\"p\">};</span>\n</div><div class=\"line\"><a id=\"l-313\" name=\"l-313\"></a><span class=\"linenos\">313</span><span class=\"c1\">// Count up the number of pointers in the array</span>\n</div><div class=\"line\"><a id=\"l-314\" name=\"l-314\"></a><span class=\"linenos\">314</span><span class=\"kr\">int</span><span class=\"w\"> </span><span class=\"n\">variableCount_complete</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kr\">sizeof</span><span class=\"p\">(</span><span class=\"n\">variableList_complete</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">/</span>\n</div><div class=\"line\"><a id=\"l-315\" name=\"l-315\"></a><span class=\"linenos\">315</span><span class=\"w\">    </span><span class=\"kr\">sizeof</span><span class=\"p\">(</span><span class=\"n\">variableList_complete</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]);</span>\n</div><div class=\"line\"><a id=\"l-316\" name=\"l-316\"></a><span class=\"linenos\">316</span><span class=\"c1\">// Create the VariableArray object</span>\n</div><div class=\"line\"><a id=\"l-317\" name=\"l-317\"></a><span class=\"linenos\">317</span><span class=\"n\">VariableArray</span><span class=\"w\"> </span><span class=\"nf\">arrayComplete</span><span class=\"p\">(</span><span class=\"n\">variableCount_complete</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">variableList_complete</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-318\" name=\"l-318\"></a><span class=\"linenos\">318</span>\n</div><div class=\"line\"><a id=\"l-319\" name=\"l-319\"></a><span class=\"linenos\">319</span>\n</div><div class=\"line\"><a id=\"l-320\" name=\"l-320\"></a><span class=\"linenos\">320</span><span class=\"c1\">// Put only the particularly interesting variables into a second array</span>\n</div><div class=\"line\"><a id=\"l-321\" name=\"l-321\"></a><span class=\"linenos\">321</span><span class=\"c1\">// NOTE:  We can the same variables into multiple arrays</span>\n</div><div class=\"line\"><a id=\"l-322\" name=\"l-322\"></a><span class=\"linenos\">322</span><span class=\"n\">Variable</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">variableList_toGo</span><span class=\"p\">[]</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"n\">y504DOmgL</span><span class=\"p\">,</span><span class=\"w\">  </span><span class=\"n\">y504Temp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">y511Turb</span><span class=\"p\">,</span>\n</div><div class=\"line\"><a id=\"l-323\" name=\"l-323\"></a><span class=\"linenos\">323</span><span class=\"w\">                                 </span><span class=\"n\">y514Chloro</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">y520Cond</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">modemRSSI</span><span class=\"p\">};</span>\n</div><div class=\"line\"><a id=\"l-324\" name=\"l-324\"></a><span class=\"linenos\">324</span><span class=\"c1\">// Count up the number of pointers in the array</span>\n</div><div class=\"line\"><a id=\"l-325\" name=\"l-325\"></a><span class=\"linenos\">325</span><span class=\"kr\">int</span><span class=\"w\"> </span><span class=\"n\">variableCount_toGo</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kr\">sizeof</span><span class=\"p\">(</span><span class=\"n\">variableList_toGo</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">/</span>\n</div><div class=\"line\"><a id=\"l-326\" name=\"l-326\"></a><span class=\"linenos\">326</span><span class=\"w\">    </span><span class=\"kr\">sizeof</span><span class=\"p\">(</span><span class=\"n\">variableList_toGo</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]);</span>\n</div><div class=\"line\"><a id=\"l-327\" name=\"l-327\"></a><span class=\"linenos\">327</span><span class=\"c1\">// Create the VariableArray object</span>\n</div><div class=\"line\"><a id=\"l-328\" name=\"l-328\"></a><span class=\"linenos\">328</span><span class=\"n\">VariableArray</span><span class=\"w\"> </span><span class=\"nf\">arrayToGo</span><span class=\"p\">(</span><span class=\"n\">variableCount_toGo</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">variableList_toGo</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-329\" name=\"l-329\"></a><span class=\"linenos\">329</span><span class=\"cm\">/** End [variable_arrays] */</span>\n</div><div class=\"line\"><a id=\"l-330\" name=\"l-330\"></a><span class=\"linenos\">330</span>\n</div><div class=\"line\"><a id=\"l-331\" name=\"l-331\"></a><span class=\"linenos\">331</span>\n</div><div class=\"line\"><a id=\"l-332\" name=\"l-332\"></a><span class=\"linenos\">332</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-333\" name=\"l-333\"></a><span class=\"linenos\">333</span><span class=\"c1\">//  The Logger Object[s]</span>\n</div><div class=\"line\"><a id=\"l-334\" name=\"l-334\"></a><span class=\"linenos\">334</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-335\" name=\"l-335\"></a><span class=\"linenos\">335</span><span class=\"cm\">/** Start [loggers] */</span>\n</div><div class=\"line\"><a id=\"l-336\" name=\"l-336\"></a><span class=\"linenos\">336</span><span class=\"c1\">// Create one new logger instance for the complete array</span>\n</div><div class=\"line\"><a id=\"l-337\" name=\"l-337\"></a><span class=\"linenos\">337</span><span class=\"n\">Logger</span><span class=\"w\"> </span><span class=\"nf\">loggerAllVars</span><span class=\"p\">(</span><span class=\"n\">LoggerID</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">loggingInterval</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">arrayComplete</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-338\" name=\"l-338\"></a><span class=\"linenos\">338</span>\n</div><div class=\"line\"><a id=\"l-339\" name=\"l-339\"></a><span class=\"linenos\">339</span><span class=\"c1\">// Create &quot;another&quot; logger for the variables to go out over the internet</span>\n</div><div class=\"line\"><a id=\"l-340\" name=\"l-340\"></a><span class=\"linenos\">340</span><span class=\"n\">Logger</span><span class=\"w\"> </span><span class=\"nf\">loggerToGo</span><span class=\"p\">(</span><span class=\"n\">LoggerID</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">loggingInterval</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">arrayToGo</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-341\" name=\"l-341\"></a><span class=\"linenos\">341</span><span class=\"cm\">/** End [loggers] */</span>\n</div><div class=\"line\"><a id=\"l-342\" name=\"l-342\"></a><span class=\"linenos\">342</span>\n</div><div class=\"line\"><a id=\"l-343\" name=\"l-343\"></a><span class=\"linenos\">343</span>\n</div><div class=\"line\"><a id=\"l-344\" name=\"l-344\"></a><span class=\"linenos\">344</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-345\" name=\"l-345\"></a><span class=\"linenos\">345</span><span class=\"c1\">//  Creating Data Publisher[s]</span>\n</div><div class=\"line\"><a id=\"l-346\" name=\"l-346\"></a><span class=\"linenos\">346</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-347\" name=\"l-347\"></a><span class=\"linenos\">347</span><span class=\"cm\">/** Start [publishers] */</span>\n</div><div class=\"line\"><a id=\"l-348\" name=\"l-348\"></a><span class=\"linenos\">348</span><span class=\"c1\">// Create a publisher to Monitor My Watershed / EnviroDIY Data Sharing Portal</span>\n</div><div class=\"line\"><a id=\"l-349\" name=\"l-349\"></a><span class=\"linenos\">349</span><span class=\"c1\">// Device registration and sampling feature information can be obtained after</span>\n</div><div class=\"line\"><a id=\"l-350\" name=\"l-350\"></a><span class=\"linenos\">350</span><span class=\"c1\">// registration at https://monitormywatershed.org or https://data.envirodiy.org</span>\n</div><div class=\"line\"><a id=\"l-351\" name=\"l-351\"></a><span class=\"linenos\">351</span><span class=\"kr\">const</span><span class=\"w\"> </span><span class=\"kr\">char</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">registrationToken</span><span class=\"w\"> </span><span class=\"o\">=</span>\n</div><div class=\"line\"><a id=\"l-352\" name=\"l-352\"></a><span class=\"linenos\">352</span><span class=\"w\">    </span><span class=\"s\">&quot;12345678-abcd-1234-ef00-1234567890ab&quot;</span><span class=\"p\">;</span><span class=\"w\">  </span><span class=\"c1\">// Device registration token</span>\n</div><div class=\"line\"><a id=\"l-353\" name=\"l-353\"></a><span class=\"linenos\">353</span><span class=\"kr\">const</span><span class=\"w\"> </span><span class=\"kr\">char</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">samplingFeature</span><span class=\"w\"> </span><span class=\"o\">=</span>\n</div><div class=\"line\"><a id=\"l-354\" name=\"l-354\"></a><span class=\"linenos\">354</span><span class=\"w\">    </span><span class=\"s\">&quot;12345678-abcd-1234-ef00-1234567890ab&quot;</span><span class=\"p\">;</span><span class=\"w\">  </span><span class=\"c1\">// Sampling feature UUID</span>\n</div><div class=\"line\"><a id=\"l-355\" name=\"l-355\"></a><span class=\"linenos\">355</span>\n</div><div class=\"line\"><a id=\"l-356\" name=\"l-356\"></a><span class=\"linenos\">356</span><span class=\"c1\">// Create a data publisher for the Monitor My Watershed/EnviroDIY POST endpoint</span>\n</div><div class=\"line\"><a id=\"l-357\" name=\"l-357\"></a><span class=\"linenos\">357</span><span class=\"c1\">// This is only attached to the logger with the shorter variable array</span>\n</div><div class=\"line\"><a id=\"l-358\" name=\"l-358\"></a><span class=\"linenos\">358</span><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;publishers/EnviroDIYPublisher.h&gt;</span>\n</div><div class=\"line\"><a id=\"l-359\" name=\"l-359\"></a><span class=\"linenos\">359</span><span class=\"n\">EnviroDIYPublisher</span><span class=\"w\"> </span><span class=\"nf\">EnviroDIYPOST</span><span class=\"p\">(</span><span class=\"n\">loggerToGo</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">modem</span><span class=\"p\">.</span><span class=\"n\">gsmClient</span><span class=\"p\">,</span>\n</div><div class=\"line\"><a id=\"l-360\" name=\"l-360\"></a><span class=\"linenos\">360</span><span class=\"w\">                                 </span><span class=\"n\">registrationToken</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">samplingFeature</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-361\" name=\"l-361\"></a><span class=\"linenos\">361</span><span class=\"cm\">/** End [publishers] */</span>\n</div><div class=\"line\"><a id=\"l-362\" name=\"l-362\"></a><span class=\"linenos\">362</span>\n</div><div class=\"line\"><a id=\"l-363\" name=\"l-363\"></a><span class=\"linenos\">363</span>\n</div><div class=\"line\"><a id=\"l-364\" name=\"l-364\"></a><span class=\"linenos\">364</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-365\" name=\"l-365\"></a><span class=\"linenos\">365</span><span class=\"c1\">//  Working Functions</span>\n</div><div class=\"line\"><a id=\"l-366\" name=\"l-366\"></a><span class=\"linenos\">366</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-367\" name=\"l-367\"></a><span class=\"linenos\">367</span><span class=\"cm\">/** Start [working_functions] */</span>\n</div><div class=\"line\"><a id=\"l-368\" name=\"l-368\"></a><span class=\"linenos\">368</span><span class=\"c1\">// Flashes the LED&#39;s on the primary board</span>\n</div><div class=\"line\"><a id=\"l-369\" name=\"l-369\"></a><span class=\"linenos\">369</span><span class=\"kr\">void</span><span class=\"w\"> </span><span class=\"nf\">greenredflash</span><span class=\"p\">(</span><span class=\"kr\">uint8_t</span><span class=\"w\"> </span><span class=\"n\">numFlash</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kr\">uint8_t</span><span class=\"w\"> </span><span class=\"n\">rate</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">75</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-370\" name=\"l-370\"></a><span class=\"linenos\">370</span><span class=\"w\">    </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kr\">uint8_t</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">numFlash</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">++</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-371\" name=\"l-371\"></a><span class=\"linenos\">371</span><span class=\"w\">        </span><span class=\"nf\">digitalWrite</span><span class=\"p\">(</span><span class=\"n\">greenLED</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kr\">HIGH</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-372\" name=\"l-372\"></a><span class=\"linenos\">372</span><span class=\"w\">        </span><span class=\"nf\">digitalWrite</span><span class=\"p\">(</span><span class=\"n\">redLED</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kr\">LOW</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-373\" name=\"l-373\"></a><span class=\"linenos\">373</span><span class=\"w\">        </span><span class=\"nf\">delay</span><span class=\"p\">(</span><span class=\"n\">rate</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-374\" name=\"l-374\"></a><span class=\"linenos\">374</span><span class=\"w\">        </span><span class=\"nf\">digitalWrite</span><span class=\"p\">(</span><span class=\"n\">greenLED</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kr\">LOW</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-375\" name=\"l-375\"></a><span class=\"linenos\">375</span><span class=\"w\">        </span><span class=\"nf\">digitalWrite</span><span class=\"p\">(</span><span class=\"n\">redLED</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kr\">HIGH</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-376\" name=\"l-376\"></a><span class=\"linenos\">376</span><span class=\"w\">        </span><span class=\"nf\">delay</span><span class=\"p\">(</span><span class=\"n\">rate</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-377\" name=\"l-377\"></a><span class=\"linenos\">377</span><span class=\"w\">    </span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-378\" name=\"l-378\"></a><span class=\"linenos\">378</span><span class=\"w\">    </span><span class=\"nf\">digitalWrite</span><span class=\"p\">(</span><span class=\"n\">redLED</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kr\">LOW</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-379\" name=\"l-379\"></a><span class=\"linenos\">379</span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-380\" name=\"l-380\"></a><span class=\"linenos\">380</span>\n</div><div class=\"line\"><a id=\"l-381\" name=\"l-381\"></a><span class=\"linenos\">381</span><span class=\"c1\">// Reads the battery voltage</span>\n</div><div class=\"line\"><a id=\"l-382\" name=\"l-382\"></a><span class=\"linenos\">382</span><span class=\"c1\">// NOTE: This will actually return the battery level from the previous update!</span>\n</div><div class=\"line\"><a id=\"l-383\" name=\"l-383\"></a><span class=\"linenos\">383</span><span class=\"kr\">float</span><span class=\"w\"> </span><span class=\"nf\">getBatteryVoltage</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-384\" name=\"l-384\"></a><span class=\"linenos\">384</span><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">mcuBoard</span><span class=\"p\">.</span><span class=\"n\">sensorValues</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">-9999</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">mcuBoard</span><span class=\"p\">.</span><span class=\"n\">update</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-385\" name=\"l-385\"></a><span class=\"linenos\">385</span><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">mcuBoard</span><span class=\"p\">.</span><span class=\"n\">sensorValues</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">];</span>\n</div><div class=\"line\"><a id=\"l-386\" name=\"l-386\"></a><span class=\"linenos\">386</span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-387\" name=\"l-387\"></a><span class=\"linenos\">387</span><span class=\"cm\">/** End [working_functions] */</span>\n</div><div class=\"line\"><a id=\"l-388\" name=\"l-388\"></a><span class=\"linenos\">388</span>\n</div><div class=\"line\"><a id=\"l-389\" name=\"l-389\"></a><span class=\"linenos\">389</span>\n</div><div class=\"line\"><a id=\"l-390\" name=\"l-390\"></a><span class=\"linenos\">390</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-391\" name=\"l-391\"></a><span class=\"linenos\">391</span><span class=\"c1\">//  Arduino Setup Function</span>\n</div><div class=\"line\"><a id=\"l-392\" name=\"l-392\"></a><span class=\"linenos\">392</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-393\" name=\"l-393\"></a><span class=\"linenos\">393</span><span class=\"cm\">/** Start [setup] */</span>\n</div><div class=\"line\"><a id=\"l-394\" name=\"l-394\"></a><span class=\"linenos\">394</span><span class=\"kr\">void</span><span class=\"w\"> </span><span class=\"nb\">setup</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-395\" name=\"l-395\"></a><span class=\"linenos\">395</span><span class=\"c1\">// Wait for USB connection to be established by PC</span>\n</div><div class=\"line\"><a id=\"l-396\" name=\"l-396\"></a><span class=\"linenos\">396</span><span class=\"c1\">// NOTE:  Only use this when debugging - if not connected to a PC, this</span>\n</div><div class=\"line\"><a id=\"l-397\" name=\"l-397\"></a><span class=\"linenos\">397</span><span class=\"c1\">// could prevent the script from starting</span>\n</div><div class=\"line\"><a id=\"l-398\" name=\"l-398\"></a><span class=\"linenos\">398</span><span class=\"cp\">#if defined(SERIAL_PORT_USBVIRTUAL)</span>\n</div><div class=\"line\"><a id=\"l-399\" name=\"l-399\"></a><span class=\"linenos\">399</span><span class=\"w\">    </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">SERIAL_PORT_USBVIRTUAL</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"nf\">millis</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">10000</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-400\" name=\"l-400\"></a><span class=\"linenos\">400</span><span class=\"w\">        </span><span class=\"c1\">// wait</span>\n</div><div class=\"line\"><a id=\"l-401\" name=\"l-401\"></a><span class=\"linenos\">401</span><span class=\"w\">    </span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-402\" name=\"l-402\"></a><span class=\"linenos\">402</span><span class=\"cp\">#endif</span>\n</div><div class=\"line\"><a id=\"l-403\" name=\"l-403\"></a><span class=\"linenos\">403</span>\n</div><div class=\"line\"><a id=\"l-404\" name=\"l-404\"></a><span class=\"linenos\">404</span><span class=\"w\">    </span><span class=\"c1\">// Start the primary serial connection</span>\n</div><div class=\"line\"><a id=\"l-405\" name=\"l-405\"></a><span class=\"linenos\">405</span><span class=\"w\">    </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">begin</span><span class=\"p\">(</span><span class=\"n\">serialBaud</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-406\" name=\"l-406\"></a><span class=\"linenos\">406</span>\n</div><div class=\"line\"><a id=\"l-407\" name=\"l-407\"></a><span class=\"linenos\">407</span><span class=\"w\">    </span><span class=\"c1\">// Print a start-up note to the first serial port</span>\n</div><div class=\"line\"><a id=\"l-408\" name=\"l-408\"></a><span class=\"linenos\">408</span><span class=\"w\">    </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">F</span><span class=\"p\">(</span><span class=\"s\">&quot;Now running &quot;</span><span class=\"p\">));</span>\n</div><div class=\"line\"><a id=\"l-409\" name=\"l-409\"></a><span class=\"linenos\">409</span><span class=\"w\">    </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">sketchName</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-410\" name=\"l-410\"></a><span class=\"linenos\">410</span><span class=\"w\">    </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">F</span><span class=\"p\">(</span><span class=\"s\">&quot; on Logger &quot;</span><span class=\"p\">));</span>\n</div><div class=\"line\"><a id=\"l-411\" name=\"l-411\"></a><span class=\"linenos\">411</span><span class=\"w\">    </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">println</span><span class=\"p\">(</span><span class=\"n\">LoggerID</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-412\" name=\"l-412\"></a><span class=\"linenos\">412</span><span class=\"w\">    </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">println</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-413\" name=\"l-413\"></a><span class=\"linenos\">413</span>\n</div><div class=\"line\"><a id=\"l-414\" name=\"l-414\"></a><span class=\"linenos\">414</span><span class=\"w\">    </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">F</span><span class=\"p\">(</span><span class=\"s\">&quot;Using ModularSensors Library version &quot;</span><span class=\"p\">));</span>\n</div><div class=\"line\"><a id=\"l-415\" name=\"l-415\"></a><span class=\"linenos\">415</span><span class=\"w\">    </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">println</span><span class=\"p\">(</span><span class=\"n\">MODULAR_SENSORS_VERSION</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-416\" name=\"l-416\"></a><span class=\"linenos\">416</span>\n</div><div class=\"line\"><a id=\"l-417\" name=\"l-417\"></a><span class=\"linenos\">417</span><span class=\"w\">    </span><span class=\"c1\">// Start the serial connection with the modem</span>\n</div><div class=\"line\"><a id=\"l-418\" name=\"l-418\"></a><span class=\"linenos\">418</span><span class=\"w\">    </span><span class=\"n\">modemSerial</span><span class=\"p\">.</span><span class=\"nf\">begin</span><span class=\"p\">(</span><span class=\"n\">modemBaud</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-419\" name=\"l-419\"></a><span class=\"linenos\">419</span>\n</div><div class=\"line\"><a id=\"l-420\" name=\"l-420\"></a><span class=\"linenos\">420</span><span class=\"w\">    </span><span class=\"c1\">// Start the stream for the modbus sensors; all currently supported modbus</span>\n</div><div class=\"line\"><a id=\"l-421\" name=\"l-421\"></a><span class=\"linenos\">421</span><span class=\"w\">    </span><span class=\"c1\">// sensors use 9600 baud</span>\n</div><div class=\"line\"><a id=\"l-422\" name=\"l-422\"></a><span class=\"linenos\">422</span><span class=\"w\">    </span><span class=\"n\">modbusSerial</span><span class=\"p\">.</span><span class=\"nf\">begin</span><span class=\"p\">(</span><span class=\"mi\">9600</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-423\" name=\"l-423\"></a><span class=\"linenos\">423</span>\n</div><div class=\"line\"><a id=\"l-424\" name=\"l-424\"></a><span class=\"linenos\">424</span><span class=\"c1\">// Assign pins SERCOM functionality for SAMD boards</span>\n</div><div class=\"line\"><a id=\"l-425\" name=\"l-425\"></a><span class=\"linenos\">425</span><span class=\"c1\">// NOTE:  This must happen *after* the various serial.begin statements</span>\n</div><div class=\"line\"><a id=\"l-426\" name=\"l-426\"></a><span class=\"linenos\">426</span><span class=\"cp\">#if defined(ARDUINO_ARCH_SAMD)</span>\n</div><div class=\"line\"><a id=\"l-427\" name=\"l-427\"></a><span class=\"linenos\">427</span><span class=\"cp\">#ifndef ENABLE_SERIAL2</span>\n</div><div class=\"line\"><a id=\"l-428\" name=\"l-428\"></a><span class=\"linenos\">428</span><span class=\"w\">    </span><span class=\"n\">pinPeripheral</span><span class=\"p\">(</span><span class=\"mi\">10</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">PIO_SERCOM</span><span class=\"p\">);</span><span class=\"w\">  </span><span class=\"c1\">// Serial2 Tx/Dout = SERCOM1 Pad #2</span>\n</div><div class=\"line\"><a id=\"l-429\" name=\"l-429\"></a><span class=\"linenos\">429</span><span class=\"w\">    </span><span class=\"n\">pinPeripheral</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">PIO_SERCOM</span><span class=\"p\">);</span><span class=\"w\">  </span><span class=\"c1\">// Serial2 Rx/Din = SERCOM1 Pad #0</span>\n</div><div class=\"line\"><a id=\"l-430\" name=\"l-430\"></a><span class=\"linenos\">430</span><span class=\"cp\">#endif</span>\n</div><div class=\"line\"><a id=\"l-431\" name=\"l-431\"></a><span class=\"linenos\">431</span><span class=\"cp\">#endif</span>\n</div><div class=\"line\"><a id=\"l-432\" name=\"l-432\"></a><span class=\"linenos\">432</span><span class=\"w\">    </span><span class=\"c1\">// Set up pins for the LED&#39;s</span>\n</div><div class=\"line\"><a id=\"l-433\" name=\"l-433\"></a><span class=\"linenos\">433</span><span class=\"w\">    </span><span class=\"nf\">pinMode</span><span class=\"p\">(</span><span class=\"n\">greenLED</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kr\">OUTPUT</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-434\" name=\"l-434\"></a><span class=\"linenos\">434</span><span class=\"w\">    </span><span class=\"nf\">digitalWrite</span><span class=\"p\">(</span><span class=\"n\">greenLED</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kr\">LOW</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-435\" name=\"l-435\"></a><span class=\"linenos\">435</span><span class=\"w\">    </span><span class=\"nf\">pinMode</span><span class=\"p\">(</span><span class=\"n\">redLED</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kr\">OUTPUT</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-436\" name=\"l-436\"></a><span class=\"linenos\">436</span><span class=\"w\">    </span><span class=\"nf\">digitalWrite</span><span class=\"p\">(</span><span class=\"n\">redLED</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kr\">LOW</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-437\" name=\"l-437\"></a><span class=\"linenos\">437</span><span class=\"w\">    </span><span class=\"c1\">// Blink the LEDs to show the board is on and starting up</span>\n</div><div class=\"line\"><a id=\"l-438\" name=\"l-438\"></a><span class=\"linenos\">438</span><span class=\"w\">    </span><span class=\"n\">greenredflash</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-439\" name=\"l-439\"></a><span class=\"linenos\">439</span>\n</div><div class=\"line\"><a id=\"l-440\" name=\"l-440\"></a><span class=\"linenos\">440</span><span class=\"w\">    </span><span class=\"c1\">// Set the timezones for the logger/data and the RTC</span>\n</div><div class=\"line\"><a id=\"l-441\" name=\"l-441\"></a><span class=\"linenos\">441</span><span class=\"w\">    </span><span class=\"c1\">// Logging in the given time zone</span>\n</div><div class=\"line\"><a id=\"l-442\" name=\"l-442\"></a><span class=\"linenos\">442</span><span class=\"w\">    </span><span class=\"n\">Logger</span><span class=\"o\">::</span><span class=\"n\">setLoggerTimeZone</span><span class=\"p\">(</span><span class=\"n\">timeZone</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-443\" name=\"l-443\"></a><span class=\"linenos\">443</span><span class=\"w\">    </span><span class=\"c1\">// It is STRONGLY RECOMMENDED that you set the RTC to be in UTC (UTC+0)</span>\n</div><div class=\"line\"><a id=\"l-444\" name=\"l-444\"></a><span class=\"linenos\">444</span><span class=\"w\">    </span><span class=\"n\">Logger</span><span class=\"o\">::</span><span class=\"n\">setRTCTimeZone</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-445\" name=\"l-445\"></a><span class=\"linenos\">445</span>\n</div><div class=\"line\"><a id=\"l-446\" name=\"l-446\"></a><span class=\"linenos\">446</span><span class=\"w\">    </span><span class=\"c1\">// Attach the same modem to both loggers</span>\n</div><div class=\"line\"><a id=\"l-447\" name=\"l-447\"></a><span class=\"linenos\">447</span><span class=\"w\">    </span><span class=\"c1\">// It is only needed for the logger that will be sending out data, but</span>\n</div><div class=\"line\"><a id=\"l-448\" name=\"l-448\"></a><span class=\"linenos\">448</span><span class=\"w\">    </span><span class=\"c1\">// attaching it to both allows either logger to control NIST synchronization</span>\n</div><div class=\"line\"><a id=\"l-449\" name=\"l-449\"></a><span class=\"linenos\">449</span><span class=\"w\">    </span><span class=\"n\">loggerAllVars</span><span class=\"p\">.</span><span class=\"n\">attachModem</span><span class=\"p\">(</span><span class=\"n\">modem</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-450\" name=\"l-450\"></a><span class=\"linenos\">450</span><span class=\"w\">    </span><span class=\"n\">loggerToGo</span><span class=\"p\">.</span><span class=\"n\">attachModem</span><span class=\"p\">(</span><span class=\"n\">modem</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-451\" name=\"l-451\"></a><span class=\"linenos\">451</span><span class=\"w\">    </span><span class=\"n\">modem</span><span class=\"p\">.</span><span class=\"n\">setModemLED</span><span class=\"p\">(</span><span class=\"n\">modemLEDPin</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-452\" name=\"l-452\"></a><span class=\"linenos\">452</span><span class=\"w\">    </span><span class=\"n\">loggerAllVars</span><span class=\"p\">.</span><span class=\"n\">setLoggerPins</span><span class=\"p\">(</span><span class=\"n\">wakePin</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">sdCardSSPin</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">sdCardPwrPin</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">buttonPin</span><span class=\"p\">,</span>\n</div><div class=\"line\"><a id=\"l-453\" name=\"l-453\"></a><span class=\"linenos\">453</span><span class=\"w\">                                </span><span class=\"n\">greenLED</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-454\" name=\"l-454\"></a><span class=\"linenos\">454</span>\n</div><div class=\"line\"><a id=\"l-455\" name=\"l-455\"></a><span class=\"linenos\">455</span><span class=\"w\">    </span><span class=\"c1\">// Set up the connection information with EnviroDIY for both loggers</span>\n</div><div class=\"line\"><a id=\"l-456\" name=\"l-456\"></a><span class=\"linenos\">456</span><span class=\"w\">    </span><span class=\"c1\">// Doing this for both loggers ensures that the header of the csv will have</span>\n</div><div class=\"line\"><a id=\"l-457\" name=\"l-457\"></a><span class=\"linenos\">457</span><span class=\"w\">    </span><span class=\"c1\">// the tokens in it</span>\n</div><div class=\"line\"><a id=\"l-458\" name=\"l-458\"></a><span class=\"linenos\">458</span><span class=\"w\">    </span><span class=\"n\">loggerAllVars</span><span class=\"p\">.</span><span class=\"n\">setSamplingFeatureUUID</span><span class=\"p\">(</span><span class=\"n\">samplingFeature</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-459\" name=\"l-459\"></a><span class=\"linenos\">459</span><span class=\"w\">    </span><span class=\"n\">loggerToGo</span><span class=\"p\">.</span><span class=\"n\">setSamplingFeatureUUID</span><span class=\"p\">(</span><span class=\"n\">samplingFeature</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-460\" name=\"l-460\"></a><span class=\"linenos\">460</span>\n</div><div class=\"line\"><a id=\"l-461\" name=\"l-461\"></a><span class=\"linenos\">461</span><span class=\"w\">    </span><span class=\"c1\">// Note:  Please change these battery voltages to match your battery</span>\n</div><div class=\"line\"><a id=\"l-462\" name=\"l-462\"></a><span class=\"linenos\">462</span>\n</div><div class=\"line\"><a id=\"l-463\" name=\"l-463\"></a><span class=\"linenos\">463</span><span class=\"w\">    </span><span class=\"c1\">// Set up the sensors, except at lowest battery level</span>\n</div><div class=\"line\"><a id=\"l-464\" name=\"l-464\"></a><span class=\"linenos\">464</span><span class=\"w\">    </span><span class=\"c1\">// Like with the logger, because the variables are duplicated in the arrays,</span>\n</div><div class=\"line\"><a id=\"l-465\" name=\"l-465\"></a><span class=\"linenos\">465</span><span class=\"w\">    </span><span class=\"c1\">// we only need to do this for the complete array.</span>\n</div><div class=\"line\"><a id=\"l-466\" name=\"l-466\"></a><span class=\"linenos\">466</span><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">getBatteryVoltage</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"mf\">3.4</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-467\" name=\"l-467\"></a><span class=\"linenos\">467</span><span class=\"w\">        </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">println</span><span class=\"p\">(</span><span class=\"n\">F</span><span class=\"p\">(</span><span class=\"s\">&quot;Setting up sensors...&quot;</span><span class=\"p\">));</span>\n</div><div class=\"line\"><a id=\"l-468\" name=\"l-468\"></a><span class=\"linenos\">468</span><span class=\"w\">        </span><span class=\"n\">arrayComplete</span><span class=\"p\">.</span><span class=\"n\">setupSensors</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-469\" name=\"l-469\"></a><span class=\"linenos\">469</span><span class=\"w\">    </span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-470\" name=\"l-470\"></a><span class=\"linenos\">470</span>\n</div><div class=\"line\"><a id=\"l-471\" name=\"l-471\"></a><span class=\"linenos\">471</span><span class=\"w\">    </span><span class=\"c1\">// Sync the clock if it isn&#39;t valid or we have battery to spare</span>\n</div><div class=\"line\"><a id=\"l-472\" name=\"l-472\"></a><span class=\"linenos\">472</span><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">getBatteryVoltage</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"mf\">3.55</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"o\">!</span><span class=\"n\">loggerAllVars</span><span class=\"p\">.</span><span class=\"n\">isRTCSane</span><span class=\"p\">())</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-473\" name=\"l-473\"></a><span class=\"linenos\">473</span><span class=\"w\">        </span><span class=\"c1\">// Synchronize the RTC with NIST</span>\n</div><div class=\"line\"><a id=\"l-474\" name=\"l-474\"></a><span class=\"linenos\">474</span><span class=\"w\">        </span><span class=\"c1\">// This will also set up the modem</span>\n</div><div class=\"line\"><a id=\"l-475\" name=\"l-475\"></a><span class=\"linenos\">475</span><span class=\"w\">        </span><span class=\"n\">loggerAllVars</span><span class=\"p\">.</span><span class=\"n\">syncRTC</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-476\" name=\"l-476\"></a><span class=\"linenos\">476</span><span class=\"w\">    </span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-477\" name=\"l-477\"></a><span class=\"linenos\">477</span>\n</div><div class=\"line\"><a id=\"l-478\" name=\"l-478\"></a><span class=\"linenos\">478</span><span class=\"w\">    </span><span class=\"c1\">// Create the log file, adding the default header to it</span>\n</div><div class=\"line\"><a id=\"l-479\" name=\"l-479\"></a><span class=\"linenos\">479</span><span class=\"w\">    </span><span class=\"c1\">// Do this last so we have the best chance of getting the time correct and</span>\n</div><div class=\"line\"><a id=\"l-480\" name=\"l-480\"></a><span class=\"linenos\">480</span><span class=\"w\">    </span><span class=\"c1\">// all sensor names correct</span>\n</div><div class=\"line\"><a id=\"l-481\" name=\"l-481\"></a><span class=\"linenos\">481</span><span class=\"w\">    </span><span class=\"c1\">// Writing to the SD card can be power intensive, so if we&#39;re skipping</span>\n</div><div class=\"line\"><a id=\"l-482\" name=\"l-482\"></a><span class=\"linenos\">482</span><span class=\"w\">    </span><span class=\"c1\">// the sensor setup we&#39;ll skip this too.</span>\n</div><div class=\"line\"><a id=\"l-483\" name=\"l-483\"></a><span class=\"linenos\">483</span><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">getBatteryVoltage</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"mf\">3.4</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-484\" name=\"l-484\"></a><span class=\"linenos\">484</span><span class=\"w\">        </span><span class=\"n\">loggerAllVars</span><span class=\"p\">.</span><span class=\"n\">turnOnSDcard</span><span class=\"p\">(</span>\n</div><div class=\"line\"><a id=\"l-485\" name=\"l-485\"></a><span class=\"linenos\">485</span><span class=\"w\">            </span><span class=\"kr\">true</span><span class=\"p\">);</span><span class=\"w\">  </span><span class=\"c1\">// true = wait for card to settle after power up</span>\n</div><div class=\"line\"><a id=\"l-486\" name=\"l-486\"></a><span class=\"linenos\">486</span><span class=\"w\">        </span><span class=\"n\">loggerAllVars</span><span class=\"p\">.</span><span class=\"n\">createLogFile</span><span class=\"p\">(</span><span class=\"kr\">true</span><span class=\"p\">);</span><span class=\"w\">  </span><span class=\"c1\">// true = write a new header</span>\n</div><div class=\"line\"><a id=\"l-487\" name=\"l-487\"></a><span class=\"linenos\">487</span><span class=\"w\">        </span><span class=\"n\">loggerAllVars</span><span class=\"p\">.</span><span class=\"n\">turnOffSDcard</span><span class=\"p\">(</span>\n</div><div class=\"line\"><a id=\"l-488\" name=\"l-488\"></a><span class=\"linenos\">488</span><span class=\"w\">            </span><span class=\"kr\">true</span><span class=\"p\">);</span><span class=\"w\">  </span><span class=\"c1\">// true = wait for internal housekeeping after write</span>\n</div><div class=\"line\"><a id=\"l-489\" name=\"l-489\"></a><span class=\"linenos\">489</span><span class=\"w\">    </span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-490\" name=\"l-490\"></a><span class=\"linenos\">490</span>\n</div><div class=\"line\"><a id=\"l-491\" name=\"l-491\"></a><span class=\"linenos\">491</span><span class=\"w\">    </span><span class=\"c1\">// Call the processor sleep</span>\n</div><div class=\"line\"><a id=\"l-492\" name=\"l-492\"></a><span class=\"linenos\">492</span><span class=\"w\">    </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">println</span><span class=\"p\">(</span><span class=\"n\">F</span><span class=\"p\">(</span><span class=\"s\">&quot;Putting processor to sleep&quot;</span><span class=\"p\">));</span>\n</div><div class=\"line\"><a id=\"l-493\" name=\"l-493\"></a><span class=\"linenos\">493</span><span class=\"w\">    </span><span class=\"n\">loggerAllVars</span><span class=\"p\">.</span><span class=\"n\">systemSleep</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-494\" name=\"l-494\"></a><span class=\"linenos\">494</span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-495\" name=\"l-495\"></a><span class=\"linenos\">495</span><span class=\"cm\">/** End [setup] */</span>\n</div><div class=\"line\"><a id=\"l-496\" name=\"l-496\"></a><span class=\"linenos\">496</span>\n</div><div class=\"line\"><a id=\"l-497\" name=\"l-497\"></a><span class=\"linenos\">497</span>\n</div><div class=\"line\"><a id=\"l-498\" name=\"l-498\"></a><span class=\"linenos\">498</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-499\" name=\"l-499\"></a><span class=\"linenos\">499</span><span class=\"c1\">//  Arduino Loop Function</span>\n</div><div class=\"line\"><a id=\"l-500\" name=\"l-500\"></a><span class=\"linenos\">500</span><span class=\"c1\">// ==========================================================================</span>\n</div><div class=\"line\"><a id=\"l-501\" name=\"l-501\"></a><span class=\"linenos\">501</span><span class=\"cm\">/** Start [loop] */</span>\n</div><div class=\"line\"><a id=\"l-502\" name=\"l-502\"></a><span class=\"linenos\">502</span><span class=\"c1\">// Use this long loop when you want to do something special</span>\n</div><div class=\"line\"><a id=\"l-503\" name=\"l-503\"></a><span class=\"linenos\">503</span><span class=\"c1\">// Because of the way alarms work on the RTC, it will wake the processor and</span>\n</div><div class=\"line\"><a id=\"l-504\" name=\"l-504\"></a><span class=\"linenos\">504</span><span class=\"c1\">// start the loop every minute exactly on the minute.</span>\n</div><div class=\"line\"><a id=\"l-505\" name=\"l-505\"></a><span class=\"linenos\">505</span><span class=\"c1\">// The processor may also be woken up by another interrupt or level change on a</span>\n</div><div class=\"line\"><a id=\"l-506\" name=\"l-506\"></a><span class=\"linenos\">506</span><span class=\"c1\">// pin - from a button or some other input.</span>\n</div><div class=\"line\"><a id=\"l-507\" name=\"l-507\"></a><span class=\"linenos\">507</span><span class=\"c1\">// The &quot;if&quot; statements in the loop determine what will happen - whether the</span>\n</div><div class=\"line\"><a id=\"l-508\" name=\"l-508\"></a><span class=\"linenos\">508</span><span class=\"c1\">// sensors update, testing mode starts, or it goes back to sleep.</span>\n</div><div class=\"line\"><a id=\"l-509\" name=\"l-509\"></a><span class=\"linenos\">509</span><span class=\"kr\">void</span><span class=\"w\"> </span><span class=\"nb\">loop</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-510\" name=\"l-510\"></a><span class=\"linenos\">510</span><span class=\"w\">    </span><span class=\"c1\">// Reset the watchdog</span>\n</div><div class=\"line\"><a id=\"l-511\" name=\"l-511\"></a><span class=\"linenos\">511</span><span class=\"w\">    </span><span class=\"n\">loggerAllVars</span><span class=\"p\">.</span><span class=\"n\">watchDogTimer</span><span class=\"p\">.</span><span class=\"n\">resetWatchDog</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-512\" name=\"l-512\"></a><span class=\"linenos\">512</span>\n</div><div class=\"line\"><a id=\"l-513\" name=\"l-513\"></a><span class=\"linenos\">513</span><span class=\"w\">    </span><span class=\"c1\">// Assuming we were woken up by the clock, check if the current time is an</span>\n</div><div class=\"line\"><a id=\"l-514\" name=\"l-514\"></a><span class=\"linenos\">514</span><span class=\"w\">    </span><span class=\"c1\">// even interval of the logging interval</span>\n</div><div class=\"line\"><a id=\"l-515\" name=\"l-515\"></a><span class=\"linenos\">515</span><span class=\"w\">    </span><span class=\"c1\">// We&#39;re only doing anything at all if the battery is above 3.4V</span>\n</div><div class=\"line\"><a id=\"l-516\" name=\"l-516\"></a><span class=\"linenos\">516</span><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">loggerAllVars</span><span class=\"p\">.</span><span class=\"n\">checkInterval</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">getBatteryVoltage</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"mf\">3.4</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-517\" name=\"l-517\"></a><span class=\"linenos\">517</span><span class=\"w\">        </span><span class=\"c1\">// Flag to notify that we&#39;re in already awake and logging a point</span>\n</div><div class=\"line\"><a id=\"l-518\" name=\"l-518\"></a><span class=\"linenos\">518</span><span class=\"w\">        </span><span class=\"n\">Logger</span><span class=\"o\">::</span><span class=\"n\">isLoggingNow</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kr\">true</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-519\" name=\"l-519\"></a><span class=\"linenos\">519</span><span class=\"w\">        </span><span class=\"n\">loggerAllVars</span><span class=\"p\">.</span><span class=\"n\">watchDogTimer</span><span class=\"p\">.</span><span class=\"n\">resetWatchDog</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-520\" name=\"l-520\"></a><span class=\"linenos\">520</span>\n</div><div class=\"line\"><a id=\"l-521\" name=\"l-521\"></a><span class=\"linenos\">521</span><span class=\"w\">        </span><span class=\"c1\">// Print a line to show new reading</span>\n</div><div class=\"line\"><a id=\"l-522\" name=\"l-522\"></a><span class=\"linenos\">522</span><span class=\"w\">        </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">println</span><span class=\"p\">(</span><span class=\"n\">F</span><span class=\"p\">(</span><span class=\"s\">&quot;------------------------------------------&quot;</span><span class=\"p\">));</span>\n</div><div class=\"line\"><a id=\"l-523\" name=\"l-523\"></a><span class=\"linenos\">523</span><span class=\"w\">        </span><span class=\"c1\">// Turn on the LED to show we&#39;re taking a reading</span>\n</div><div class=\"line\"><a id=\"l-524\" name=\"l-524\"></a><span class=\"linenos\">524</span><span class=\"w\">        </span><span class=\"n\">loggerAllVars</span><span class=\"p\">.</span><span class=\"n\">alertOn</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-525\" name=\"l-525\"></a><span class=\"linenos\">525</span><span class=\"w\">        </span><span class=\"c1\">// Power up the SD Card, but skip any waits after power up</span>\n</div><div class=\"line\"><a id=\"l-526\" name=\"l-526\"></a><span class=\"linenos\">526</span><span class=\"w\">        </span><span class=\"n\">loggerAllVars</span><span class=\"p\">.</span><span class=\"n\">turnOnSDcard</span><span class=\"p\">(</span><span class=\"kr\">false</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-527\" name=\"l-527\"></a><span class=\"linenos\">527</span><span class=\"w\">        </span><span class=\"n\">loggerAllVars</span><span class=\"p\">.</span><span class=\"n\">watchDogTimer</span><span class=\"p\">.</span><span class=\"n\">resetWatchDog</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-528\" name=\"l-528\"></a><span class=\"linenos\">528</span>\n</div><div class=\"line\"><a id=\"l-529\" name=\"l-529\"></a><span class=\"linenos\">529</span><span class=\"w\">        </span><span class=\"c1\">// Start the stream for the modbus sensors</span>\n</div><div class=\"line\"><a id=\"l-530\" name=\"l-530\"></a><span class=\"linenos\">530</span><span class=\"w\">        </span><span class=\"c1\">// Because RS485 adapters tend to &quot;steal&quot; current from the data pins</span>\n</div><div class=\"line\"><a id=\"l-531\" name=\"l-531\"></a><span class=\"linenos\">531</span><span class=\"w\">        </span><span class=\"c1\">// we will explicitly start and end the serial connection in the loop.</span>\n</div><div class=\"line\"><a id=\"l-532\" name=\"l-532\"></a><span class=\"linenos\">532</span><span class=\"w\">        </span><span class=\"n\">modbusSerial</span><span class=\"p\">.</span><span class=\"nf\">begin</span><span class=\"p\">(</span><span class=\"mi\">9600</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-533\" name=\"l-533\"></a><span class=\"linenos\">533</span>\n</div><div class=\"line\"><a id=\"l-534\" name=\"l-534\"></a><span class=\"linenos\">534</span><span class=\"w\">        </span><span class=\"c1\">// Do a complete update on the &quot;full&quot; array.</span>\n</div><div class=\"line\"><a id=\"l-535\" name=\"l-535\"></a><span class=\"linenos\">535</span><span class=\"w\">        </span><span class=\"c1\">// This this includes powering all of the sensors, getting updated</span>\n</div><div class=\"line\"><a id=\"l-536\" name=\"l-536\"></a><span class=\"linenos\">536</span><span class=\"w\">        </span><span class=\"c1\">// values, and turing them back off.</span>\n</div><div class=\"line\"><a id=\"l-537\" name=\"l-537\"></a><span class=\"linenos\">537</span><span class=\"w\">        </span><span class=\"c1\">// NOTE:  The wake function for each sensor should force sensor setup</span>\n</div><div class=\"line\"><a id=\"l-538\" name=\"l-538\"></a><span class=\"linenos\">538</span><span class=\"w\">        </span><span class=\"c1\">// to run if the sensor was not previously set up.</span>\n</div><div class=\"line\"><a id=\"l-539\" name=\"l-539\"></a><span class=\"linenos\">539</span><span class=\"w\">        </span><span class=\"n\">arrayComplete</span><span class=\"p\">.</span><span class=\"n\">completeUpdate</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-540\" name=\"l-540\"></a><span class=\"linenos\">540</span><span class=\"w\">        </span><span class=\"n\">loggerAllVars</span><span class=\"p\">.</span><span class=\"n\">watchDogTimer</span><span class=\"p\">.</span><span class=\"n\">resetWatchDog</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-541\" name=\"l-541\"></a><span class=\"linenos\">541</span>\n</div><div class=\"line\"><a id=\"l-542\" name=\"l-542\"></a><span class=\"linenos\">542</span><span class=\"w\">        </span><span class=\"c1\">// End the stream for the modbus sensors</span>\n</div><div class=\"line\"><a id=\"l-543\" name=\"l-543\"></a><span class=\"linenos\">543</span><span class=\"w\">        </span><span class=\"c1\">// Because RS485 adapters tend to &quot;steal&quot; current from the data pins</span>\n</div><div class=\"line\"><a id=\"l-544\" name=\"l-544\"></a><span class=\"linenos\">544</span><span class=\"w\">        </span><span class=\"c1\">// we will explicitly start and end the serial connection in the loop.</span>\n</div><div class=\"line\"><a id=\"l-545\" name=\"l-545\"></a><span class=\"linenos\">545</span><span class=\"w\">        </span><span class=\"n\">modbusSerial</span><span class=\"p\">.</span><span class=\"nf\">end</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-546\" name=\"l-546\"></a><span class=\"linenos\">546</span>\n</div><div class=\"line\"><a id=\"l-547\" name=\"l-547\"></a><span class=\"linenos\">547</span><span class=\"cp\">#if defined(AltSoftSerial_h)</span>\n</div><div class=\"line\"><a id=\"l-548\" name=\"l-548\"></a><span class=\"linenos\">548</span><span class=\"w\">        </span><span class=\"c1\">// Explicitly set the pin modes for the AltSoftSerial pins to make sure</span>\n</div><div class=\"line\"><a id=\"l-549\" name=\"l-549\"></a><span class=\"linenos\">549</span><span class=\"w\">        </span><span class=\"c1\">// they&#39;re low</span>\n</div><div class=\"line\"><a id=\"l-550\" name=\"l-550\"></a><span class=\"linenos\">550</span><span class=\"w\">        </span><span class=\"nf\">pinMode</span><span class=\"p\">(</span><span class=\"mi\">5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kr\">OUTPUT</span><span class=\"p\">);</span><span class=\"w\">  </span><span class=\"c1\">// On a Mayfly, pin D5 is the AltSoftSerial Tx pin</span>\n</div><div class=\"line\"><a id=\"l-551\" name=\"l-551\"></a><span class=\"linenos\">551</span><span class=\"w\">        </span><span class=\"nf\">pinMode</span><span class=\"p\">(</span><span class=\"mi\">6</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kr\">OUTPUT</span><span class=\"p\">);</span><span class=\"w\">  </span><span class=\"c1\">// On a Mayfly, pin D6 is the AltSoftSerial Rx pin</span>\n</div><div class=\"line\"><a id=\"l-552\" name=\"l-552\"></a><span class=\"linenos\">552</span><span class=\"w\">        </span><span class=\"nf\">digitalWrite</span><span class=\"p\">(</span><span class=\"mi\">5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kr\">LOW</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-553\" name=\"l-553\"></a><span class=\"linenos\">553</span><span class=\"w\">        </span><span class=\"nf\">digitalWrite</span><span class=\"p\">(</span><span class=\"mi\">6</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kr\">LOW</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-554\" name=\"l-554\"></a><span class=\"linenos\">554</span><span class=\"cp\">#endif</span>\n</div><div class=\"line\"><a id=\"l-555\" name=\"l-555\"></a><span class=\"linenos\">555</span>\n</div><div class=\"line\"><a id=\"l-556\" name=\"l-556\"></a><span class=\"linenos\">556</span><span class=\"cp\">#if defined(ARDUINO_SAMD_ZERO)</span>\n</div><div class=\"line\"><a id=\"l-557\" name=\"l-557\"></a><span class=\"linenos\">557</span><span class=\"w\">        </span><span class=\"nf\">digitalWrite</span><span class=\"p\">(</span><span class=\"mi\">10</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kr\">LOW</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-558\" name=\"l-558\"></a><span class=\"linenos\">558</span><span class=\"w\">        </span><span class=\"nf\">digitalWrite</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kr\">LOW</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-559\" name=\"l-559\"></a><span class=\"linenos\">559</span><span class=\"cp\">#endif</span>\n</div><div class=\"line\"><a id=\"l-560\" name=\"l-560\"></a><span class=\"linenos\">560</span>\n</div><div class=\"line\"><a id=\"l-561\" name=\"l-561\"></a><span class=\"linenos\">561</span><span class=\"w\">        </span><span class=\"c1\">// Create a csv data record and save it to the log file</span>\n</div><div class=\"line\"><a id=\"l-562\" name=\"l-562\"></a><span class=\"linenos\">562</span><span class=\"w\">        </span><span class=\"n\">loggerAllVars</span><span class=\"p\">.</span><span class=\"n\">logToSD</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-563\" name=\"l-563\"></a><span class=\"linenos\">563</span><span class=\"w\">        </span><span class=\"n\">loggerAllVars</span><span class=\"p\">.</span><span class=\"n\">watchDogTimer</span><span class=\"p\">.</span><span class=\"n\">resetWatchDog</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-564\" name=\"l-564\"></a><span class=\"linenos\">564</span>\n</div><div class=\"line\"><a id=\"l-565\" name=\"l-565\"></a><span class=\"linenos\">565</span><span class=\"w\">        </span><span class=\"c1\">// Connect to the network</span>\n</div><div class=\"line\"><a id=\"l-566\" name=\"l-566\"></a><span class=\"linenos\">566</span><span class=\"w\">        </span><span class=\"c1\">// Again, we&#39;re only doing this if the battery is doing well</span>\n</div><div class=\"line\"><a id=\"l-567\" name=\"l-567\"></a><span class=\"linenos\">567</span><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">getBatteryVoltage</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"mf\">3.55</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-568\" name=\"l-568\"></a><span class=\"linenos\">568</span><span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">modem</span><span class=\"p\">.</span><span class=\"n\">modemWake</span><span class=\"p\">())</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-569\" name=\"l-569\"></a><span class=\"linenos\">569</span><span class=\"w\">                </span><span class=\"n\">loggerAllVars</span><span class=\"p\">.</span><span class=\"n\">watchDogTimer</span><span class=\"p\">.</span><span class=\"n\">resetWatchDog</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-570\" name=\"l-570\"></a><span class=\"linenos\">570</span><span class=\"w\">                </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">modem</span><span class=\"p\">.</span><span class=\"n\">connectInternet</span><span class=\"p\">())</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-571\" name=\"l-571\"></a><span class=\"linenos\">571</span><span class=\"w\">                    </span><span class=\"n\">loggerAllVars</span><span class=\"p\">.</span><span class=\"n\">watchDogTimer</span><span class=\"p\">.</span><span class=\"n\">resetWatchDog</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-572\" name=\"l-572\"></a><span class=\"linenos\">572</span><span class=\"w\">                    </span><span class=\"c1\">// Publish data to remotes</span>\n</div><div class=\"line\"><a id=\"l-573\" name=\"l-573\"></a><span class=\"linenos\">573</span><span class=\"w\">                    </span><span class=\"n\">loggerToGo</span><span class=\"p\">.</span><span class=\"n\">publishDataToRemotes</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-574\" name=\"l-574\"></a><span class=\"linenos\">574</span><span class=\"w\">                    </span><span class=\"n\">modem</span><span class=\"p\">.</span><span class=\"n\">updateModemMetadata</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-575\" name=\"l-575\"></a><span class=\"linenos\">575</span>\n</div><div class=\"line\"><a id=\"l-576\" name=\"l-576\"></a><span class=\"linenos\">576</span><span class=\"w\">                    </span><span class=\"n\">loggerAllVars</span><span class=\"p\">.</span><span class=\"n\">watchDogTimer</span><span class=\"p\">.</span><span class=\"n\">resetWatchDog</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-577\" name=\"l-577\"></a><span class=\"linenos\">577</span><span class=\"w\">                    </span><span class=\"c1\">// Sync the clock at noon</span>\n</div><div class=\"line\"><a id=\"l-578\" name=\"l-578\"></a><span class=\"linenos\">578</span><span class=\"w\">                    </span><span class=\"c1\">// NOTE:  All loggers have the same clock, pick one</span>\n</div><div class=\"line\"><a id=\"l-579\" name=\"l-579\"></a><span class=\"linenos\">579</span><span class=\"w\">                    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">Logger</span><span class=\"o\">::</span><span class=\"n\">markedLocalEpochTime</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span>\n</div><div class=\"line\"><a id=\"l-580\" name=\"l-580\"></a><span class=\"linenos\">580</span><span class=\"w\">                        </span><span class=\"n\">Logger</span><span class=\"o\">::</span><span class=\"n\">markedLocalEpochTime</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"w\"> </span><span class=\"mi\">86400</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">43200</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-581\" name=\"l-581\"></a><span class=\"linenos\">581</span><span class=\"w\">                        </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">println</span><span class=\"p\">(</span><span class=\"n\">F</span><span class=\"p\">(</span><span class=\"s\">&quot;Running a daily clock sync...&quot;</span><span class=\"p\">));</span>\n</div><div class=\"line\"><a id=\"l-582\" name=\"l-582\"></a><span class=\"linenos\">582</span><span class=\"w\">                        </span><span class=\"n\">loggerAllVars</span><span class=\"p\">.</span><span class=\"n\">setRTClock</span><span class=\"p\">(</span><span class=\"n\">modem</span><span class=\"p\">.</span><span class=\"n\">getNISTTime</span><span class=\"p\">());</span>\n</div><div class=\"line\"><a id=\"l-583\" name=\"l-583\"></a><span class=\"linenos\">583</span><span class=\"w\">                    </span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-584\" name=\"l-584\"></a><span class=\"linenos\">584</span>\n</div><div class=\"line\"><a id=\"l-585\" name=\"l-585\"></a><span class=\"linenos\">585</span><span class=\"w\">                    </span><span class=\"c1\">// Disconnect from the network</span>\n</div><div class=\"line\"><a id=\"l-586\" name=\"l-586\"></a><span class=\"linenos\">586</span><span class=\"w\">                    </span><span class=\"n\">loggerAllVars</span><span class=\"p\">.</span><span class=\"n\">watchDogTimer</span><span class=\"p\">.</span><span class=\"n\">resetWatchDog</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-587\" name=\"l-587\"></a><span class=\"linenos\">587</span><span class=\"w\">                    </span><span class=\"n\">modem</span><span class=\"p\">.</span><span class=\"n\">disconnectInternet</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-588\" name=\"l-588\"></a><span class=\"linenos\">588</span><span class=\"w\">                </span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-589\" name=\"l-589\"></a><span class=\"linenos\">589</span><span class=\"w\">            </span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-590\" name=\"l-590\"></a><span class=\"linenos\">590</span><span class=\"w\">            </span><span class=\"c1\">// Turn the modem off</span>\n</div><div class=\"line\"><a id=\"l-591\" name=\"l-591\"></a><span class=\"linenos\">591</span><span class=\"w\">            </span><span class=\"n\">loggerAllVars</span><span class=\"p\">.</span><span class=\"n\">watchDogTimer</span><span class=\"p\">.</span><span class=\"n\">resetWatchDog</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-592\" name=\"l-592\"></a><span class=\"linenos\">592</span><span class=\"w\">            </span><span class=\"n\">modem</span><span class=\"p\">.</span><span class=\"n\">modemSleepPowerDown</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-593\" name=\"l-593\"></a><span class=\"linenos\">593</span><span class=\"w\">        </span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-594\" name=\"l-594\"></a><span class=\"linenos\">594</span>\n</div><div class=\"line\"><a id=\"l-595\" name=\"l-595\"></a><span class=\"linenos\">595</span><span class=\"w\">        </span><span class=\"c1\">// Cut power from the SD card - without additional housekeeping wait</span>\n</div><div class=\"line\"><a id=\"l-596\" name=\"l-596\"></a><span class=\"linenos\">596</span><span class=\"w\">        </span><span class=\"n\">loggerAllVars</span><span class=\"p\">.</span><span class=\"n\">turnOffSDcard</span><span class=\"p\">(</span><span class=\"kr\">false</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-597\" name=\"l-597\"></a><span class=\"linenos\">597</span><span class=\"w\">        </span><span class=\"n\">loggerAllVars</span><span class=\"p\">.</span><span class=\"n\">watchDogTimer</span><span class=\"p\">.</span><span class=\"n\">resetWatchDog</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-598\" name=\"l-598\"></a><span class=\"linenos\">598</span><span class=\"w\">        </span><span class=\"c1\">// Turn off the LED</span>\n</div><div class=\"line\"><a id=\"l-599\" name=\"l-599\"></a><span class=\"linenos\">599</span><span class=\"w\">        </span><span class=\"n\">loggerAllVars</span><span class=\"p\">.</span><span class=\"n\">alertOff</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-600\" name=\"l-600\"></a><span class=\"linenos\">600</span><span class=\"w\">        </span><span class=\"c1\">// Print a line to show reading ended</span>\n</div><div class=\"line\"><a id=\"l-601\" name=\"l-601\"></a><span class=\"linenos\">601</span><span class=\"w\">        </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">println</span><span class=\"p\">(</span><span class=\"n\">F</span><span class=\"p\">(</span><span class=\"s\">&quot;------------------------------------------</span><span class=\"se\">\\n</span><span class=\"s\">&quot;</span><span class=\"p\">));</span>\n</div><div class=\"line\"><a id=\"l-602\" name=\"l-602\"></a><span class=\"linenos\">602</span>\n</div><div class=\"line\"><a id=\"l-603\" name=\"l-603\"></a><span class=\"linenos\">603</span><span class=\"w\">        </span><span class=\"c1\">// Unset flag</span>\n</div><div class=\"line\"><a id=\"l-604\" name=\"l-604\"></a><span class=\"linenos\">604</span><span class=\"w\">        </span><span class=\"n\">Logger</span><span class=\"o\">::</span><span class=\"n\">isLoggingNow</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kr\">false</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-605\" name=\"l-605\"></a><span class=\"linenos\">605</span><span class=\"w\">    </span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-606\" name=\"l-606\"></a><span class=\"linenos\">606</span>\n</div><div class=\"line\"><a id=\"l-607\" name=\"l-607\"></a><span class=\"linenos\">607</span><span class=\"w\">    </span><span class=\"c1\">// Check if it was instead the testing interrupt that woke us up</span>\n</div><div class=\"line\"><a id=\"l-608\" name=\"l-608\"></a><span class=\"linenos\">608</span><span class=\"w\">    </span><span class=\"c1\">// Want to enter the testing mode for the &quot;complete&quot; logger so we can see</span>\n</div><div class=\"line\"><a id=\"l-609\" name=\"l-609\"></a><span class=\"linenos\">609</span><span class=\"w\">    </span><span class=\"c1\">// the data from _ALL_ sensors</span>\n</div><div class=\"line\"><a id=\"l-610\" name=\"l-610\"></a><span class=\"linenos\">610</span><span class=\"w\">    </span><span class=\"c1\">// NOTE:  The testingISR attached to the button at the end of the &quot;setup()&quot;</span>\n</div><div class=\"line\"><a id=\"l-611\" name=\"l-611\"></a><span class=\"linenos\">611</span><span class=\"w\">    </span><span class=\"c1\">// function turns on the startTesting flag.  So we know if that flag is set</span>\n</div><div class=\"line\"><a id=\"l-612\" name=\"l-612\"></a><span class=\"linenos\">612</span><span class=\"w\">    </span><span class=\"c1\">// then we want to run the testing mode function.</span>\n</div><div class=\"line\"><a id=\"l-613\" name=\"l-613\"></a><span class=\"linenos\">613</span><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">Logger</span><span class=\"o\">::</span><span class=\"n\">startTesting</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">loggerAllVars</span><span class=\"p\">.</span><span class=\"n\">testingMode</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-614\" name=\"l-614\"></a><span class=\"linenos\">614</span>\n</div><div class=\"line\"><a id=\"l-615\" name=\"l-615\"></a><span class=\"linenos\">615</span><span class=\"w\">    </span><span class=\"c1\">// Call the processor sleep</span>\n</div><div class=\"line\"><a id=\"l-616\" name=\"l-616\"></a><span class=\"linenos\">616</span><span class=\"w\">    </span><span class=\"c1\">// Only need to do this for one of the loggers</span>\n</div><div class=\"line\"><a id=\"l-617\" name=\"l-617\"></a><span class=\"linenos\">617</span><span class=\"w\">    </span><span class=\"n\">loggerAllVars</span><span class=\"p\">.</span><span class=\"n\">systemSleep</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-618\" name=\"l-618\"></a><span class=\"linenos\">618</span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-619\" name=\"l-619\"></a><span class=\"linenos\">619</span>\n</div><div class=\"line\"><a id=\"l-620\" name=\"l-620\"></a><span class=\"linenos\">620</span><span class=\"cm\">/** End [loop] */</span>\n</div></div></div></section>",
    "sections": [
      [
        "example_data_saving_unique",
        "Unique Features of the Data Saving Example",
        []
      ],
      [
        "example_data_saving_using",
        "To Use this Example",
        [
          [
            "example_data_saving_pio",
            "Prepare and set up PlatformIO",
            []
          ],
          [
            "example_data_saving_logger_id",
            "Set the logger ID",
            []
          ],
          [
            "example_data_saving_uuids",
            "Set the universally universal identifiers (UUID) for each variable",
            []
          ],
          [
            "example_data_saving_upload",
            "Upload!",
            []
          ]
        ]
      ],
      [
        "example_data_saving_pio_config",
        "PlatformIO Configuration",
        []
      ],
      [
        "example_data_saving_code",
        "The Complete Code",
        []
      ]
    ],
    "deprecated": null,
    "since": null,
    "example_navigation": null,
    "footer_navigation": [
      [
        "example_double_log.html",
        "Multiple Time Intervals"
      ],
      [
        "page_examples_complex.html",
        "Calculations and Complex Logging"
      ],
      null
    ],
    "topics": [],
    "dirs": [],
    "files": [],
    "namespaces": [],
    "classes": [],
    "base_classes": [],
    "derived_classes": [],
    "enums": [],
    "typedefs": [],
    "funcs": [],
    "vars": [],
    "defines": [],
    "public_types": [],
    "public_static_funcs": [],
    "typeless_funcs": [],
    "public_funcs": [],
    "signals": [],
    "public_slots": [],
    "public_static_vars": [],
    "public_vars": [],
    "protected_types": [],
    "protected_static_funcs": [],
    "protected_funcs": [],
    "protected_slots": [],
    "protected_static_vars": [],
    "protected_vars": [],
    "private_funcs": [],
    "private_slots": [],
    "related": [],
    "friend_funcs": [],
    "groups": [],
    "has_enum_details": false,
    "has_typedef_details": false,
    "has_func_details": false,
    "has_var_details": false,
    "has_define_details": false,
    "breadcrumb": [
      [
        "ModularSensors",
        "index.html"
      ],
      [
        "Examples Using ModularSensors",
        "page_the_examples.html"
      ],
      [
        "Calculations and Complex Logging",
        "page_examples_complex.html"
      ],
      [
        "Minimizing Cellular Data Use",
        "example_data_saving.html"
      ]
    ],
    "breadcrumbGroup": [
      [
        "Minimizing Cellular Data Use",
        "example_data_saving.html"
      ]
    ]
  }
}